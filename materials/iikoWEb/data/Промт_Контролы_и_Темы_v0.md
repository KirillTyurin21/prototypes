# Промт для v0: Admin панель Customer Screen iiko — Полная версия

> **Версия:** 1.0 (Финальная сборка — Шаг 5: Подсказки + Контролы + Темы + Настройки терминалов + Мок-данные + Сценарии)  
> **Дата:** 10.02.2026  
> **Автор:** Copilot на основе плана работ  
> **Статус:** ✅ Финальная версия (готов к загрузке в v0)  
> **Самодостаточность:** Данный промт является **единственным документом**, необходимым для генерации прототипа в v0. Содержит все разделы Admin панели Customer Screen: Подсказки, Контролы, Темы, Настройки терминалов. Заменяет предыдущий промт `Промт Админ панели от 09.02.2026.md`.

---

## 1. Контекст проекта

Это **полная самодостаточная спецификация** Admin панели Customer Screen в системе iiko для генерации кликабельного прототипа в v0. Документ покрывает **все четыре раздела** Admin панели:

1. **Подсказки** — справочник записей допродаж (триггеры, рекомендации, скидки, слоганы)
2. **Контролы** — справочник визуальных шаблонов с типизацией (Анимация / Подсказка)
3. **Конструктор Тем** — с новым элементом «Подсказки» (Область + настройки)
4. **Настройки терминалов** — матрица назначений, расширенная колонкой «Подсказки»

Все разделы используют единые UI-паттерны и навигацию iikoWeb.

> **Важно:** Визуальная стилистика Admin панели должна соответствовать скриншотам iikoWeb, приложенным к промту. Скриншоты являются **первичным источником** для дизайнерских решений. Текстовое описание ниже задаёт структурные и функциональные рамки.

> **Карта разделов (для навигации по документу):**
>
> | # | Раздел | Описание |
> |---|--------|----------|
> | 1–6 | Общие разделы | Контекст, стек, дизайн-система, навигация, правила, ограничения |
> | **6A** | **Подсказки** | Справочник подсказок + карточка + селекторы |
> | **7** | **Контролы** | Справочник + типизация + карточки анимации и подсказки |
> | **8** | **Темы** | Список + конструктор + элемент «Подсказки» (Область) |
> | **9** | **Настройки терминалов** | Матрица назначений + колонка «Подсказки» |
> | **10** | **Мок-данные** | Все сущности с TypeScript-интерфейсами |
> | **11** | **Сценарии** | 6 сквозных E2E-сценариев + единый AppState |

---

## 2. Технологический стек

> **Примечание:** Реальная Admin панель iikoWeb построена на **Angular 16 + Angular Material + TypeScript**. Для генерации интерактивного прототипа в v0 используем React-стек, но **визуальная стилистика** должна точно соответствовать Angular Material / iikoWeb.

| Параметр | Значение для v0 | Реальный стек iikoWeb |
|----------|-----------------|----------------------|
| Фреймворк | Next.js 16 (App Router), React 19 | Angular 16 |
| UI-библиотека | shadcn/ui (стилизация под Angular Material) | Angular Material |
| Язык | TypeScript | TypeScript |
| Стилизация | Tailwind CSS v4 | Angular Material theming |
| Иконки | Lucide React | Material Icons |
| Состояние | React useState/useReducer | NgRx / Services |

**Цель:** Прототип в v0 должен выглядеть и вести себя как настоящая Admin панель iikoWeb. Разработчики затем перенесут логику и структуру на Angular 16.

---

## 3. Дизайн-система

> **🖼️ Источник стилистики:** Скриншоты iikoWeb (приложены отдельно). Описание ниже задаёт только структурные правила. При противоречии между текстом и скриншотами — **скриншоты приоритетнее**.

### 3.1 Общие принципы

- **Стиль:** Корпоративный Material Design — чистый, минималистичный, без декоративных элементов
- **Плотность информации:** Высокая — компактные таблицы, минимальные отступы (стиль enterprise-приложения, не маркетингового сайта)
- **Цветовой акцент:** Минимальное использование цвета — основной акцент только на активных элементах и кнопках действий
- **Состояния:** Все интерактивные элементы должны иметь hover, active, disabled состояния

> **Цветовая палитра и типографика:** Базовые цвета, шрифты и размеры определяются по приложенным скриншотам iikoWeb. При отсутствии скриншотов — использовать следующие значения по умолчанию: фон `#FAFAFA`, акцент `#2563EB`, шрифт Geist Sans, Geist Mono.

### 3.2 Layout (структура страницы)

```
┌─────────────────────────────────────────────────────────┐
│  Хедер: гамбургер | название ресторана | уведомления     │
├──────────┬──────────────────────────────────────────────┤
│          │  Хлебные крошки                              │
│  Сайдбар │──────────────────────────────────────────────│
│  (навиг.)│                                              │
│          │  Тулбар: заголовок раздела + кнопки действий  │
│          │──────────────────────────────────────────────│
│          │                                              │
│          │  Основная рабочая область                     │
│          │  (таблица / конструктор / форма)              │
│          │                                              │
│          │                                              │
├──────────┴──────────────────────────────────────────────┤
│  Футер: copyright iiko, версия системы                   │
└─────────────────────────────────────────────────────────┘
```

**Компоненты layout:**

| Компонент | Описание | Поведение |
|-----------|----------|-----------|
| **Сайдбар** | Фиксированная левая панель навигации | Сворачивается по кнопке-гамбургеру в хедере |
| **Хедер** | Верхняя полоса на всю ширину | Содержит: гамбургер, название ресторана, уведомления, профиль администратора |
| **Хлебные крошки** | Под хедером, над тулбаром | Показывают путь: `Настройки и обслуживание системы > Дисплей покупателя > [Раздел]` |
| **Тулбар** | Под хлебными крошками | Заголовок раздела + кнопки действий (Добавить, Редактировать, Удалить) |
| **Рабочая область** | Центральная часть | Содержимое зависит от раздела: таблица, конструктор или форма |
| **Футер** | Нижняя полоса сайдбара | `© 2026 iiko`, версия системы |

### 3.3 Общие UI-компоненты (паттерны iikoWeb)

#### Справочник (таблица-список)

Используется в разделах: Подсказки, Контролы, Темы, Настройки терминалов.

| Элемент | Описание |
|---------|----------|
| **Таблица** | Строки с данными, колонки с заголовками. Hover-подсветка строк |
| **Тулбар таблицы** | Кнопки: [+ Добавить], [Редактировать (карандаш)], [Удалить (корзина)] |
| **Поиск** | Поле с иконкой лупы — быстрая фильтрация по названию |
| **Сортировка** | По клику на заголовок колонки |
| **Выделение строки** | Клик по строке = выделение. Двойной клик или кнопка = открытие карточки |

#### Боковая панель (Drawer / Sheet)

Используется для: создания/редактирования контролов, карточки подсказки.

| Элемент | Описание |
|---------|----------|
| **Расположение** | Выдвигается справа, затемняет фон |
| **Хедер** | Заголовок + кнопка закрытия (X) |
| **Тело** | Прокручиваемая область с секциями полей |
| **Футер** | Закреплён внизу: кнопки «Отмена» и «Сохранить» |

#### Модальное окно (Dialog)

Используется для: выбора типа контрола, выбора продуктов, подтверждения удаления.

| Элемент | Описание |
|---------|----------|
| **Оверлей** | Затемнение фона |
| **Контент** | Центрировано, с заголовком и кнопками действий |
| **Закрытие** | По кнопке X, по клику вне окна, по Escape |

#### Уведомления (Toast)

| Элемент | Описание |
|---------|----------|
| **Расположение** | Правый верхний угол |
| **Поведение** | Автоматически исчезает через несколько секунд |
| **Содержимое** | Заголовок + описание |

---

## 4. Навигационная структура

### 4.1 Сайдбар iikoWeb (полная структура)

Сайдбар отображает иерархическое меню. Разделы, реализуемые в этом промте, отмечены как **активные** — остальные являются заглушками (некликабельные).

```
📋 Настройки и обслуживание системы
📐 Редактор схемы зала
📥 Импорт данных
🖥️ Экраны
   ├── Дисплей покупателя           ← Раздел Customer Screen
   │     ├── Подсказки              ← РЕАЛИЗУЕМ (раздел 6A)
   │     ├── Контролы               ← 🆕 РЕАЛИЗУЕМ (Шаг 2)
   │     ├── Темы                   ← 🆕 РЕАЛИЗУЕМ (Шаг 3)
   │     └── Настройки терминалов   ← 🆕 РАСШИРЯЕМ (Шаг 3.4)
   ├── Дисплей Arrivals             ← Заглушка
   ├── Галерея                      ← Заглушка
   └── Конфигуратор плагинов iikoFront ← Заглушка
🌐 Переводы
```

> **Примечание к навигации:**  
> В реальном iikoWeb разделы «Контролы» и «Темы» уже существуют (для Arrivals). Мы **расширяем** их — добавляем типизацию контролов и элемент «Подсказки» в конструкторе Тем. В прототипе v0 показываем их как отдельные пункты меню под «Дисплей покупателя».

### 4.2 Хлебные крошки для каждого раздела

| Раздел | Хлебные крошки |
|--------|---------------|
| Подсказки | `Настройки и обслуживание системы > Дисплей покупателя > Подсказки` |
| Контролы | `Настройки и обслуживание системы > Дисплей покупателя > Контролы` |
| Темы (список) | `Настройки и обслуживание системы > Дисплей покупателя > Темы` |
| Темы (редактирование) | `Настройки и обслуживание системы > Дисплей покупателя > Темы > [Название темы]` |
| Настройки терминалов | `Настройки и обслуживание системы > Дисплей покупателя > Настройки терминалов` |

---

## 5. Общие правила интерактивности

| Правило | Описание |
|---------|----------|
| **Навигация** | Клик по пункту сайдбара → загрузка соответствующего раздела. Активный пункт подсвечен |
| **Создание сущности** | Кнопка [+ Добавить] в тулбаре → открытие drawer или модального окна |
| **Редактирование** | Клик по строке таблицы → открытие drawer с данными сущности |
| **Удаление** | Кнопка [Удалить] → модальное окно подтверждения: «Вы уверены?» |
| **Сохранение** | Кнопка «Сохранить» в drawer → toast-уведомление «Данные сохранены» |
| **Валидация** | Обязательные поля отмечены `*`. При попытке сохранить без заполнения — подсветка ошибки |
| **Hover** | Все интерактивные элементы меняют фон при наведении |
| **Переходы** | Плавные анимации открытия/закрытия drawer и модальных окон |

---

## 6. Ограничения прототипа v0

| Ограничение | Описание |
|-------------|----------|
| **Данные** | Все данные — это мок-объекты в state. Нет реального API |
| **Авторизация** | Не реализована. Хедер показывает хардкод «Администратор» |
| **Адаптивность** | Оптимизировано под десктоп (1280px+). Мобильная версия не требуется |
| **Навигация** | Переключение между разделами через state (SPA), не через роутинг. State `activeSection` хранит текущий раздел: `hints` / `controls` / `themes` / `themeEditor` / `terminals` |
| **Язык интерфейса** | Русский (все надписи, подсказки, placeholder'ы) |
| **Изображения** | Placeholder-изображения, генерируемые v0 |

---

## 6A. Раздел «Подсказки» — Справочник и Карточка

> **Подсказки** — это записи справочника допродаж. Каждая подсказка определяет: какое блюдо рекомендовать, при заказе чего (триггеры), с какой скидкой, и какой промо-текст показать покупателю. Подсказка привязывается к визуальному шаблону (Контрол подсказки, раздел 7) и назначается на терминалы (раздел 9).

---

### 6A.1 Справочник подсказок (экран списка)

**Местоположение в навигации:**  
Сайдбар → Экраны → Дисплей покупателя → **Подсказки** (активный пункт с индикатором)

**Хлебные крошки:**  
`Настройки и обслуживание системы > Дисплей покупателя > Подсказки`

---

#### Панель инструментов (тулбар)

| Элемент | Описание |
|---------|----------|
| **Заголовок** | «Подсказки» — `text-2xl font-normal` |
| **Кнопка [+ Добавить]** | Справа от заголовка, синяя кнопка с иконкой плюса. При клике → открывается drawer создания подсказки (см. 6A.2) |
| **Кнопка [Редактировать]** | Иконка карандаша. Активна при выделенной строке |
| **Кнопка [Удалить]** | Иконка корзины. Активна при выделенной строке → модальное окно подтверждения |

#### Панель поиска

| Элемент | Описание |
|---------|----------|
| **Поле поиска** | Input с иконкой лупы. Placeholder: «Поиск по названию…». Фильтрация в реальном времени по полю `name` |

#### Таблица подсказок

**Колонки:**

| # | Колонка | Описание | Сортировка |
|---|---------|----------|------------|
| 1 | **Название** | Текстовое название подсказки | Алфавитная, по клику на заголовок |
| 2 | **Период действия** | Формат: «ДД.ММ.ГГГГ – ДД.ММ.ГГГГ» | По дате |
| 3 | **Время действия** | Формат: «ЧЧ:ММ – ЧЧ:ММ» | — |
| 4 | **Статус** | Badge с цветом: **Активна** (зелёный `bg-green-100 text-green-700`), **Запланирована** (синий `bg-blue-100 text-blue-700`), **Истекла** (серый `bg-gray-100 text-gray-600`) | По статусу |

**Поведение строк:**

| Действие | Результат |
|----------|-----------|
| Hover | Подсветка строки `hover:bg-gray-50` |
| Клик по строке | Открытие drawer редактирования подсказки с заполненными данными |

#### Логика удаления

При нажатии [Удалить]:
1. Модальное окно: «Удалить подсказку «{name}»? Подсказка будет снята со всех терминалов.»
2. Кнопки: «Отмена» / «Удалить» (деструктивная, красная)
3. При подтверждении: подсказка удаляется из state `hints`, каскадная очистка `terminals[].hints` (см. 11.8), toast «Подсказка удалена»

#### Мок-данные

> Полный набор подсказок с TypeScript-интерфейсами — см. раздел **10.2**. Ниже — краткая таблица для отображения в справочнике.

| id | Название | Период | Время | Статус |
|----|----------|--------|-------|--------|
| 1 | Пирожок к кофе | 01.01.2026 – 30.06.2026 | 08:00 – 12:00 | Активна |
| 2 | Десерт к обеду | 01.03.2026 – 31.05.2026 | 12:00 – 15:00 | Запланирована |
| 3 | Сок к завтраку | 15.01.2026 – 31.12.2026 | 07:00 – 11:00 | Активна |
| 4 | Суп дня | 01.02.2026 – 30.04.2026 | 11:30 – 16:00 | Активна |
| 5 | Комбо-обед | 10.01.2026 – 31.12.2026 | 12:00 – 16:00 | Активна |

---

### 6A.2 Карточка подсказки (drawer)

**Открывается:** при создании новой подсказки или при клике по строке в таблице справочника.

**Тип компонента:** Sheet (боковая панель), выдвигается справа, ширина `max-w-2xl`, с вертикальной прокруткой.

---

#### Заголовок drawer (закреплён вверху)

| Режим | Заголовок |
|-------|-----------|
| Создание | «Добавить подсказку» |
| Редактирование | «Редактировать подсказку» |

Кнопка закрытия [X] в правом верхнем углу.

#### Секция 1: Основные параметры

Заголовок секции: «Основные параметры» — `text-sm font-medium uppercase tracking-wider`.

| Поле | Тип | Обязательное | Значение по умолч. | Placeholder |
|------|-----|-------------|---------------------|-------------|
| **Наименование** | Текстовый input | Да (`*`) | — | «Введите название подсказки» |
| **Дата начала** | Date input | Да (`*`) | Текущая дата | — |
| **Дата окончания** | Date input | Да (`*`) | Через 1 год | — |
| **Время начала** | Time input | Да (`*`) | 00:00 | — |
| **Время окончания** | Time input | Да (`*`) | 23:59 | — |

> Layout: даты в одну строку (`grid-cols-2`), время в одну строку (`grid-cols-2`).

#### Секция 2: Связка блюд

Заголовок секции: «Связка блюд».

Layout: Grid из 3 колонок `[1fr, auto, 1fr]`.

**Левая карточка — «При выборе (триггеры)»:**

| Элемент | Описание |
|---------|----------|
| Фон и рамка | Серый фон `bg-gray-50`, border |
| Список | Массив триггеров: категории (📁) и продукты (☕). Каждый элемент — строка с иконкой и названием |
| Кнопки | Внизу карточки: синяя кнопка «Добавить» (иконка +) → открывает селектор продуктов (6A.3 mode: triggers) и иконка корзины (удаление последнего триггера) |

**Центр — иконка стрелки (→).**

**Правая карточка — «Рекомендовать»:**

| Состояние | Содержимое |
|-----------|-----------|
| **Не выбрано** (по умолч.) | Серая иконка-placeholder (ImageIcon), текст «Выберите блюдо» |
| **Выбрано** | Название продукта с иконкой ☕. Квадратное изображение продукта (aspect-square). Кнопка редактирования изображения (карандаш) в правом верхнем углу. Подпись: «Изображение из внешнего меню» / «Изображение из галереи» / «Загружено пользователем». Кнопка «Вернуть изображение из меню» (если source ≠ "menu") |
| **Кнопка** | Внизу: «Выбрать блюдо» → открывает селектор продуктов (6A.3 mode: recommendation) |

> **Логика изображений подсказки:**
> - `imageSource = "menu"` → фото из карточки блюда в iiko (по умолчанию при выборе продукта)
> - `imageSource = "gallery"` → выбрано из галереи (6A.4 таб 1)
> - `imageSource = "uploaded"` → загружено пользователем (6A.4 таб 2)
> - Кнопка «Вернуть из меню» — сбрасывает на дефолтное изображение

#### Секция 3: Слоган рекомендации

| Поле | Тип | Описание |
|------|-----|----------|
| **Слоган** | Textarea (4 строки) | Placeholder: «Не забудьте купить пирожок! При покупке с кофе — скидка 15%». Промо-текст, отображается в элементе `hint-slogan` контрола подсказки |

#### Секция 4: Скидка

| Поле | Тип | Описание |
|------|-----|----------|
| **Тип скидки** | Radio: «Процент (%)» (по умолч.) / «Фиксированная сумма» | Переключение формата скидки |
| **Размер скидки** | Number input, `max-w-xs` | Числовое значение скидки |
| — | Горизонтальный разделитель | — |
| **Скидка iiko** | Select → выбор из справочника | Placeholder: «Выбрать из справочника...». Список из `iikoDiscounts` (10.7.3) |

#### Футер drawer (закреплён внизу)

| Кнопка | Стиль | Действие |
|--------|-------|----------|
| **Отмена** | Outline | Закрытие drawer без сохранения |
| **Сохранить** | Primary (синяя) | Валидация обязательных полей → сохранение в state `hints` → toast «Подсказка сохранена» / «Настройки успешно сохранены» → закрытие drawer → обновление таблицы |

**Логика сохранения:**
1. Собирается объект hintData со всеми полями: name, dates, times, slogan, discountType, discountValue, iikoDiscount, triggers[], recommendation, image, imageSource, controlId
2. Если редактируется существующая (selectedHint ≠ null) → обновляется запись в `hints`
3. Если создаётся новая → добавляется с новым id = max(ids) + 1
4. Toast → закрытие drawer

---

### 6A.3 Селектор продуктов (модальное окно)

**Тип:** Dialog (модальное окно), макс. высота 80vh.

#### Режимы работы

| Режим | Поведение |
|-------|-----------|
| `triggers` | Множественный выбор с чекбоксами. Можно выбрать категории и отдельные продукты |
| `recommendation` | Одиночный выбор с radio buttons. Опция «Не выбрано» первой в списке (курсив, серый, разделитель) |

#### Структура

| Элемент | Описание |
|---------|----------|
| **Заголовок** | «Выбор блюда / группы» |
| **Поле поиска** | Placeholder: «Поиск...», иконка лупы слева |
| **Опция «Не выбрано»** | Только для mode: recommendation. Курсив, серый текст, radio button, `border-bottom` |
| **Дерево категорий** | Категории с жёлтой иконкой папки и chevron для раскрытия. Продукты с отступом `ml-6` и иконкой ☕. Все раскрыты по умолчанию |
| **Кнопки** | «Отмена» / «Выбрать» (синяя) |

**Дерево продуктов** — используются данные из раздела **10.7.2** (7 категорий, 25+ продуктов).

**Логика:**
- В режиме recommendation при выборе продукта автоматически подгружается дефолтное изображение (imageSource = "menu")
- При нажатии «Выбрать» → возврат выбранных данных → закрытие селектора

---

### 6A.4 Селектор изображений (модальное окно)

**Тип:** Dialog с табами.

#### Таб 1: «Выбрать из галереи»

| Элемент | Описание |
|---------|----------|
| **Grid** | 4 колонки `grid-cols-4`, квадратные изображения (aspect-square) |
| **Выбор** | При клике — синяя рамка `border-blue-600` и галочка в углу |
| **Изображения** | Из массива `galleryImages` (раздел 10.7.4): 9 placeholder-фото еды |

#### Таб 2: «Загрузить с ПК»

| Элемент | Описание |
|---------|----------|
| **Зона drag-and-drop** | Dashed border, иконка Upload, текст «Перетащите файл сюда или», кнопка «Выбрать файл» |
| **После загрузки** | Превью `w-64 aspect-square`, синяя рамка, кнопка «Выбрать другой файл» |

#### Кнопки

| Кнопка | Стиль | Действие |
|--------|-------|----------|
| **Отмена** | Outline | Закрытие без действий |
| **Применить** | Primary (disabled если ничего не выбрано) | Возврат `{ imageUrl, source: "gallery" | "uploaded" }` → закрытие |

---

### 6A.5 Интерактивные сценарии

**Сценарий: Создание подсказки**
1. Пользователь нажимает [+ Добавить] → открывается drawer «Добавить подсказку»
2. Заполняет: Название = «Пирожок к кофе», Даты, Время
3. В секции «Связка блюд» нажимает «Добавить» в карточке триггеров → селектор (mode: triggers) → выбирает категорию «Кофейные напитки» и продукт «Латте большой» → «Выбрать»
4. Нажимает «Выбрать блюдо» в карточке рекомендации → селектор (mode: recommendation) → выбирает «Пирожок вишнёвый» → авто-загрузка изображения (source: menu)
5. Нажимает карандаш на изображении → селектор изображений → вкладка «Галерея» → выбирает `/cherry-pastry.jpg` → «Применить» → изображение обновлено (source: gallery)
6. Заполняет слоган: «Не забудьте купить пирожок! При покупке с кофе — скидка 15%»
7. Выбирает «Процент», вводит 15. Выбирает «Скидка на выпечку к кофе» из справочника iiko
8. Нажимает **«Сохранить»** → toast «Подсказка сохранена» → drawer закрывается → в таблице новая строка

**Сценарий: Редактирование подсказки**
1. Клик по строке «Пирожок к кофе» → drawer открывается с заполненными данными
2. Пользователь меняет слоган, увеличивает скидку до 20%
3. Нажимает «Сохранить» → данные обновлены

**Сценарий: Возврат изображения из меню**
1. Карточка рекомендации показывает кастомное изображение с подписью «Изображение из галереи»
2. Пользователь нажимает «Вернуть изображение из меню» → изображение сбрасывается на дефолтное из меню iiko

---

## 7. Раздел «Контролы»

> **Контролы** — это визуальные шаблоны, описывающие набор элементов и их настройки для отображения на Customer Screen. Контролы бывают двух типов: **Анимация** (`animation`) и **Подсказка** (`hint`). Тип определяется при создании и не может быть изменён.

---

### 7.1 Справочник контролов (экран списка)

**Местоположение в навигации:**  
Сайдбар → Экраны → Дисплей покупателя → **Контролы** (активный пункт с индикатором)

**Хлебные крошки:**  
`Настройки и обслуживание системы > Дисплей покупателя > Контролы`

---

#### Панель инструментов (тулбар)

| Элемент | Описание |
|---------|----------|
| **Заголовок** | «Контролы» |
| **Кнопка [+ Добавить]** | Справа от заголовка. При клике → модальное окно выбора типа контрола (см. 7.2) |
| **Кнопка [Редактировать]** | Иконка карандаша. Активна только при выделенной строке. Клик → открытие drawer |
| **Кнопка [Удалить]** | Иконка корзины. Активна только при выделенной строке. Клик → модальное окно подтверждения удаления |

#### Панель поиска и фильтрации

| Элемент | Описание |
|---------|----------|
| **Поле поиска** | Input с иконкой лупы. Placeholder: «Поиск по названию…». Фильтрация в реальном времени по полю `name` |
| **Фильтр по типу** | Группа из трёх кнопок-переключателей (toggle group): **Все** / **Анимации** / **Подсказки**. По умолчанию активен «Все». Фильтрует таблицу по полю `type` |

> **Поведение фильтров:** Поиск и фильтр по типу работают одновременно. Если выбран фильтр «Анимации» и введён текст «Промо» — в таблице останутся только анимации, содержащие «Промо» в названии.

#### Таблица контролов

**Колонки:**

| # | Колонка | Описание | Сортировка |
|---|---------|----------|------------|
| 1 | **Название** | Текстовое название контрола | Алфавитная, по клику на заголовок |
| 2 | **Тип** | Badge с иконкой типа + текст: «Анимация» / «Подсказка» | По клику на заголовок |
| 3 | **Кол-во элементов** | Количество элементов внутри контрола | Числовая, по клику на заголовок |

**Поведение строк:**

| Действие | Результат |
|----------|-----------|
| Hover | Подсветка строки |
| Одинарный клик | Выделение строки (активирует кнопки «Редактировать» и «Удалить» в тулбаре) |
| Двойной клик | Открытие drawer редактирования контрола |

#### Логика удаления

При нажатии кнопки [Удалить] в тулбаре:
1. Открывается модальное окно подтверждения: «Удалить контрол «{name}»?»
2. Кнопки: «Отмена» / «Удалить» (деструктивная)
3. При подтверждении: контрол удаляется из `controls`, `selectedControl` сбрасывается в `null`, показывается toast «Контрол удалён»

#### Мок-данные

```typescript
// Краткий интерфейс для справочника. Полный интерфейс с полем elements: ControlElement[] — см. раздел 10.1
interface Control {
  id: number
  name: string
  type: "animation" | "hint"
  elementsCount: number
  elements: ControlElement[]  // определение ControlElement — см. 7.3.8
}

const initialControls: Control[] = [
  { id: 1, name: "Анимация заказа", type: "animation", elementsCount: 5 },
  { id: 2, name: "Анимация добавления", type: "animation", elementsCount: 3 },
  { id: 3, name: "Промо-анимация", type: "animation", elementsCount: 4 },
  { id: 4, name: "Подсказка кофе", type: "hint", elementsCount: 6 },
  { id: 5, name: "Подсказка десерт", type: "hint", elementsCount: 4 },
  { id: 6, name: "Подсказка скидка", type: "hint", elementsCount: 7 },
]
```

#### State управление

```typescript
const [activeFilter, setActiveFilter] = useState<"all" | "animation" | "hint">("all")
const [selectedControl, setSelectedControl] = useState<Control | null>(null)
const [controls, setControls] = useState<Control[]>(initialControls)
const [searchQuery, setSearchQuery] = useState("")

// Логика фильтрации
const filteredControls = controls.filter((control) => {
  const matchesType = activeFilter === "all" || control.type === activeFilter
  const matchesSearch = control.name.toLowerCase().includes(searchQuery.toLowerCase())
  return matchesType && matchesSearch
})
```

---

### 7.2 Диалог выбора типа контрола

**Триггер:** Нажатие кнопки **[+ Добавить]** в тулбаре справочника контролов.

**Тип компонента:** Модальное окно (Dialog) — центрированное, с затемнением фона.

---

#### Структура диалога

**Заголовок:** «Выберите тип контрола»

**Тело диалога** — две карточки выбора, расположенные горизонтально:

| # | Карточка | Содержимое |
|---|----------|-----------|
| 1 | **Контрол анимации** | Иконка типа · Заголовок: «Контрол анимации» · Описание: «Визуальный шаблон для анимации добавления блюда в заказ» |
| 2 | **Контрол подсказки** | Иконка типа · Заголовок: «Контрол подсказки» · Описание: «Визуальный шаблон для подсказки с рекомендацией допродажи» |

Каждая карточка:
- Кликабельна целиком (вся область — зона клика)
- Имеет hover-состояние
- Не содержит вложенных кнопок — клик по карточке = выбор типа

**Кнопки диалога:**
- **«Отмена»** — закрытие без действий

**Дополнительные способы закрытия:**
- Клик по overlay (затемнённой области вне диалога)
- Клавиша Escape
- Кнопка [X] в правом верхнем углу

#### Поведение после выбора

1. Пользователь кликает по одной из карточек
2. Диалог закрывается
3. Открывается **drawer** для создания контрола выбранного типа:
   - «Контрол анимации» → drawer с набором элементов анимации (см. 7.4)
   - «Контрол подсказки» → drawer с набором элементов подсказки (см. 7.3)

#### Блокировка типа после создания

Тип контрола **нельзя изменить** после сохранения. От типа зависит набор доступных элементов, и смена типа на лету приведёт к потере данных.

**Поведение при редактировании существующего контрола:**
- В заголовке drawer отображается **read-only бейдж** с типом: «Анимация» или «Подсказка»
- Бейдж неактивен (не кликабелен, не имеет hover-эффекта)
- Диалог выбора типа **не появляется** — drawer открывается сразу с соответствующим набором полей
- Для смены типа пользователь должен удалить контрол и создать новый

---

### 7.3 Карточка контрола подсказки (drawer)

**Открывается:** при создании нового контрола типа «Подсказка» или при редактировании существующего контрола с `type = "hint"`.

**Тип компонента:** Sheet (боковая панель), выдвигается справа, затемняет фон.

---

#### 7.3.1 Заголовок drawer

| Режим | Заголовок | Бейдж |
|-------|-----------|-------|
| Создание | «Новый контрол» | «Подсказка» — бейдж, визуально активный (показывает выбранный тип) |
| Редактирование | «{Название контрола}» | «Подсказка» — бейдж, **read-only** (заблокирован, нельзя сменить тип) |

Кнопка закрытия [X] в правом верхнем углу.

#### 7.3.2 Layout drawer

Drawer разделён на две области:

| Область | Содержимое |
|---------|-----------|
| **Основная (левая/верхняя)** | Секция «Основные» — поле «Название» |
| **Панель «Элементы» (правая/нижняя)** | Кнопка добавления элементов, список добавленных элементов с настройками |

> Конкретное расположение областей (рядом / друг под другом) определяется по скриншотам.

#### 7.3.3 Секция «Основные»

| Поле | Тип | Обязательное | Placeholder | Валидация |
|------|-----|-------------|-------------|-----------|
| **Название** | Текстовый input | Да | «Введите название контрола» | Не менее 1 символа. При пустом поле и попытке сохранить — подсветка ошибки |

#### 7.3.4 Панель «Элементы»

**Кнопка «Добавить элемент»** → выпадающий список (dropdown) с перечнем доступных элементов (16 штук для контрола подсказки — см. таблицу ниже).

**Кнопка «Очистить элементы»** — удаляет все добавленные элементы. Выводит подтверждение: «Удалить все элементы?» с кнопками «Отмена» / «Очистить».

**Список добавленных элементов** — каждый элемент отображается как строка/аккордеон:
- В свёрнутом виде: иконка типа + название элемента + кнопка удаления [X]
- При раскрытии: появляются секции настроек элемента (Макет, Граница, Шрифт, Выравнивание)
- Порядок элементов можно менять перетаскиванием (drag & drop)

#### 7.3.5 Доступные элементы для контрола подсказки

**Переиспользуемые из анимаций (10):**

| # | type | Название | Описание |
|---|------|----------|----------|
| 1 | `area` | Область | Контейнер для группировки вложенных элементов |
| 2 | `text` | Текст | Произвольный статичный текст |
| 3 | `image` | Изображение | Кастомное статичное изображение |
| 4 | `product-image` | Изображение товара | Фото рекомендуемого блюда (из внешнего меню или кастомное) |
| 5 | `product-name` | Название продукта | Название рекомендуемого блюда |
| 6 | `full-product-name` | Полное название продукта | Полное наименование блюда |
| 7 | `foreign-product-name` | Иностранное название продукта | Название на иностранном языке |
| 8 | `price` | Цена | Текущая цена блюда |
| 9 | `product-description` | Описание продукта | Описание блюда |
| 10 | `foreign-product-description` | Описание товара (за рубежом) | Описание на иностранном языке |

**Уникальные для подсказок (6):**

| # | type | Название | Описание |
|---|------|----------|----------|
| 11 | `hint-slogan` | Слоган подсказки | Динамический промо-текст из карточки подсказки |
| 12 | `hint-banner` | Баннер подсказки | Кастомная промо-картинка из карточки подсказки |
| 13 | `discount-name` | Название скидки | Название привязанной скидки (из справочника iiko) |
| 14 | `discount-size` | Размер скидки | % или сумма скидки |
| 15 | `discounted-price` | Цена со скидкой | Вычисляемое: Цена − Скидка |
| 16 | `old-price` | Старая цена | Цена до скидки (визуально перечёркнутая) |

#### 7.3.6 Настройки элементов

При раскрытии добавленного элемента отображаются секции настроек. Набор секций зависит от типа элемента:

| Секция | Применимость | Содержимое |
|--------|-------------|-----------|
| **Макет** | Все элементы | Позиция X, Y (px), Ширина (px), Высота (px), Отступы/padding (4 значения: сверху, справа, снизу, слева) |
| **Граница** | Все элементы | Толщина рамки (px), Скругление (px). Цвет рамки и тень настраиваются на уровне Области в конструкторе Тем (раздел 8), не на уровне элементов контрола |
| **Шрифт** | Текстовые элементы (`text`, `product-name`, `full-product-name`, `foreign-product-name`, `price`, `product-description`, `foreign-product-description`, `hint-slogan`, `discount-name`, `discount-size`, `discounted-price`, `old-price`) | Семейство шрифта (select), Размер (px), Начертание: toggle-группа — **Жирный (B)** и **Курсив (I)** — независимые переключатели |
| **Выравнивание** | Те же текстовые элементы | Горизонтальное: лево / центр / право |

> Секции «Шрифт» и «Выравнивание» **не отображаются** для нетекстовых элементов: `area`, `image`, `product-image`, `hint-banner`.

#### 7.3.7 Футер drawer (закреплён внизу)

| Кнопка | Действие |
|--------|----------|
| **Отмена** | Закрытие drawer без сохранения |
| **Сохранить** | Сохранение контрола → toast «Контрол сохранён» → закрытие drawer → обновление таблицы |

#### 7.3.8 State

```typescript
interface ControlElement {
  id: number
  type: string    // из таблицы type (7.3.5)
  name: string    // отображаемое название
  settings: {
    layout: { x: number; y: number; width: number; height: number; padding: [number, number, number, number] }
    border: { width: number; radius: number }
    font?: { family: string; size: number; bold: boolean; italic: boolean }
    align?: "left" | "center" | "right"
  }
}

const [controlName, setControlName] = useState("")
const [controlElements, setControlElements] = useState<ControlElement[]>([])
const [expandedElement, setExpandedElement] = useState<number | null>(null)
```

#### 7.3.9 Мок-данные контролов подсказки

> **Краткий формат** — элементы без `settings`. Полные данные с настройками layout, border, font, align — см. раздел **10.3**.

**Контрол «Подсказка кофе»:**

```json
{
  "id": 4,
  "name": "Подсказка кофе",
  "type": "hint",
  "elements": [
    { "id": 1, "type": "product-image", "name": "Изображение товара" },
    { "id": 2, "type": "product-name", "name": "Название продукта" },
    { "id": 3, "type": "hint-slogan", "name": "Слоган подсказки" },
    { "id": 4, "type": "discount-name", "name": "Название скидки" },
    { "id": 5, "type": "discounted-price", "name": "Цена со скидкой" },
    { "id": 6, "type": "old-price", "name": "Старая цена" }
  ]
}
```

**Контрол «Подсказка десерт»:**

```json
{
  "id": 5,
  "name": "Подсказка десерт",
  "type": "hint",
  "elements": [
    { "id": 1, "type": "hint-banner", "name": "Баннер подсказки" },
    { "id": 2, "type": "hint-slogan", "name": "Слоган подсказки" },
    { "id": 3, "type": "price", "name": "Цена" },
    { "id": 4, "type": "discount-size", "name": "Размер скидки" }
  ]
}
```

**Контрол «Подсказка скидка»:**

```json
{
  "id": 6,
  "name": "Подсказка скидка",
  "type": "hint",
  "elements": [
    { "id": 1, "type": "area", "name": "Область" },
    { "id": 2, "type": "product-image", "name": "Изображение товара" },
    { "id": 3, "type": "full-product-name", "name": "Полное название продукта" },
    { "id": 4, "type": "hint-slogan", "name": "Слоган подсказки" },
    { "id": 5, "type": "hint-banner", "name": "Баннер подсказки" },
    { "id": 6, "type": "discount-name", "name": "Название скидки" },
    { "id": 7, "type": "discounted-price", "name": "Цена со скидкой" }
  ]
}
```

#### 7.3.10 Интерактивные сценарии

**Сценарий: Создание контрола подсказки**
1. Пользователь нажимает [+ Добавить] в тулбаре → открывается диалог выбора типа (7.2)
2. Выбирает «Контрол подсказки» → диалог закрывается, открывается drawer
3. Вводит название: «Подсказка кофе»
4. Нажимает «Добавить элемент» → dropdown с 16 элементами
5. Добавляет «Изображение товара», «Название продукта», «Слоган подсказки»
6. Раскрывает «Слоган подсказки» → настраивает шрифт и выравнивание
7. Нажимает «Сохранить» → toast «Контрол сохранён» → drawer закрывается → в таблице появилась новая строка

**Сценарий: Редактирование**
1. Двойной клик по строке «Подсказка кофе» → drawer открывается с заполненными данными
2. Бейдж «Подсказка» в заголовке — read-only, нельзя изменить
3. Пользователь добавляет элемент «Размер скидки»
4. Нажимает «Сохранить» → обновление данных в таблице (elementsCount +1)

**Сценарий: Очистка элементов**
1. В drawer нажимает «Очистить элементы» → подтверждение «Удалить все элементы?»
2. Подтверждает → список элементов пуст
3. Можно добавить новые элементы заново

---

### 7.4 Карточка контрола анимации (drawer)

> **Структура drawer идентична контролу подсказки (7.3).** Ниже описаны **только отличия**: другой набор доступных элементов и другие мок-данные.

#### Отличия от контрола подсказки

| Аспект | Контрол подсказки (7.3) | Контрол анимации (7.4) |
|--------|------------------------|----------------------|
| Бейдж типа в заголовке | «Подсказка» | «Анимация» |
| Всего доступных элементов | 16 (10 общих + 6 уникальных) | 15 (10 общих + 5 уникальных) |
| Уникальные элементы | Связаны со скидками и промо | Связаны с последним добавленным блюдом |
| Контекст | Промо-рекомендация с допродажей | Визуальный эффект при добавлении блюда |

#### Общие элементы (10 — совпадают с подсказками)

| # | type | Название |
|---|------|----------|
| 1 | `area` | Область |
| 2 | `text` | Текст |
| 3 | `image` | Изображение |
| 4 | `product-image` | Изображение товара |
| 5 | `product-name` | Название продукта |
| 6 | `full-product-name` | Полное название продукта |
| 7 | `foreign-product-name` | Иностранное название продукта |
| 8 | `price` | Цена |
| 9 | `product-description` | Описание продукта |
| 10 | `foreign-product-description` | Описание товара (за рубежом) |

#### Уникальные элементы анимации (5 — отсутствуют в подсказках)

| # | type | Название | Описание |
|---|------|----------|----------|
| 11 | `last-added-dish` | Последнее добавленное блюдо | Название последнего добавленного в заказ блюда |
| 12 | `quantity` | Количество продукции | Количество данной позиции в заказе |
| 13 | `measurement-unit` | Измерительная единица | шт, кг, л и т.д. |
| 14 | `nutritional-value` | Пищевая ценность | БЖУ, калории |
| 15 | `product-scale` | Масштаб продукции | Размер блюда (большой / средний / маленький) |

#### Элементы подсказок, ОТСУТСТВУЮЩИЕ в анимациях

Следующие 6 элементов **недоступны** в dropdown «Добавить элемент» для анимаций:

| type | Название | Причина |
|------|----------|---------|
| `hint-slogan` | Слоган подсказки | Анимации не содержат промо-текстов |
| `hint-banner` | Баннер подсказки | Анимации не содержат промо-баннеров |
| `discount-name` | Название скидки | Анимации не связаны со скидками |
| `discount-size` | Размер скидки | Анимации не связаны со скидками |
| `discounted-price` | Цена со скидкой | Анимации не связаны со скидками |
| `old-price` | Старая цена | Анимации не связаны со скидками |

#### Мок-данные контролов анимации

> **Краткий формат** — элементы без `settings`. Полные данные с настройками layout, border, font, align — см. раздел **10.3**.

**Контрол «Анимация заказа»:**

```json
{
  "id": 1,
  "name": "Анимация заказа",
  "type": "animation",
  "elements": [
    { "id": 1, "type": "area", "name": "Область" },
    { "id": 2, "type": "product-image", "name": "Изображение товара" },
    { "id": 3, "type": "product-name", "name": "Название продукта" },
    { "id": 4, "type": "price", "name": "Цена" },
    { "id": 5, "type": "last-added-dish", "name": "Последнее добавленное блюдо" }
  ]
}
```

**Контрол «Анимация добавления»:**

```json
{
  "id": 2,
  "name": "Анимация добавления",
  "type": "animation",
  "elements": [
    { "id": 1, "type": "product-image", "name": "Изображение товара" },
    { "id": 2, "type": "full-product-name", "name": "Полное название продукта" },
    { "id": 3, "type": "quantity", "name": "Количество продукции" }
  ]
}
```

**Контрол «Промо-анимация»:**

```json
{
  "id": 3,
  "name": "Промо-анимация",
  "type": "animation",
  "elements": [
    { "id": 1, "type": "image", "name": "Изображение" },
    { "id": 2, "type": "text", "name": "Текст" },
    { "id": 3, "type": "product-name", "name": "Название продукта" },
    { "id": 4, "type": "price", "name": "Цена" }
  ]
}
```

#### Остальное поведение

Полностью повторяет раздел 7.3: заголовок, секция «Основные», панель «Элементы», настройки элементов (Макет, Граница, Шрифт, Выравнивание), футер с кнопками «Отмена» / «Сохранить», логика сохранения и toast-уведомления.

---

### 7.5 Сводная таблица элементов по типам контролов

<!-- При изменении списка элементов — обновить таблицы в 7.3.5, 7.4 и 7.5 одновременно -->

Для удобства реализации — полная матрица доступности элементов:

| type | Название | Анимация | Подсказка |
|------|----------|----------|-----------|
| `area` | Область | ✅ | ✅ |
| `text` | Текст | ✅ | ✅ |
| `image` | Изображение | ✅ | ✅ |
| `product-image` | Изображение товара | ✅ | ✅ |
| `product-name` | Название продукта | ✅ | ✅ |
| `full-product-name` | Полное название продукта | ✅ | ✅ |
| `foreign-product-name` | Иностранное название продукта | ✅ | ✅ |
| `price` | Цена | ✅ | ✅ |
| `product-description` | Описание продукта | ✅ | ✅ |
| `foreign-product-description` | Описание товара (за рубежом) | ✅ | ✅ |
| `last-added-dish` | Последнее добавленное блюдо | ✅ | ❌ |
| `quantity` | Количество продукции | ✅ | ❌ |
| `measurement-unit` | Измерительная единица | ✅ | ❌ |
| `nutritional-value` | Пищевая ценность | ✅ | ❌ |
| `product-scale` | Масштаб продукции | ✅ | ❌ |
| `hint-slogan` | Слоган подсказки | ❌ | ✅ |
| `hint-banner` | Баннер подсказки | ❌ | ✅ |
| `discount-name` | Название скидки | ❌ | ✅ |
| `discount-size` | Размер скидки | ❌ | ✅ |
| `discounted-price` | Цена со скидкой | ❌ | ✅ |
| `old-price` | Старая цена | ❌ | ✅ |

---

## 8. Раздел «Темы» — Конструктор

> **Темы** — это визуальные макеты экрана Customer Screen. Каждая тема определяет, как выглядит дисплей покупателя: какие элементы размещены на экране и как они настроены. В конструкторе темы пользователь размещает элементы (Анимации, **Подсказки**, Рекламные кампании, изображения, тексты) на canvas экрана и настраивает их параметры.

> **🆕 Ключевое расширение:** В этом промте в конструктор тем добавляется новый элемент — **«Подсказки»**. Это контейнер (Область / Area), в который динамически помещаются контролы подсказок при срабатывании триггеров. Архитектура портирована из Arrivals (Area + Control).

---

### 8.1 Справочник тем (экран списка)

**Местоположение в навигации:**  
Сайдбар → Экраны → Дисплей покупателя → **Темы** (активный пункт с индикатором)

**Хлебные крошки:**  
`Настройки и обслуживание системы > Дисплей покупателя > Темы`

---

#### Панель инструментов (тулбар)

| Элемент | Описание |
|---------|----------|
| **Заголовок** | «Темы» |
| **Кнопка [+ Добавить]** | Справа от заголовка. При клике → создаётся новая тема и открывается конструктор (см. 8.2) |
| **Кнопка [Редактировать]** | Иконка карандаша. Активна при выделенной строке. Клик → открытие конструктора темы |
| **Кнопка [Удалить]** | Иконка корзины. Активна при выделенной строке. Клик → модальное окно подтверждения |
| **Кнопка [Дублировать]** | Иконка копирования. Активна при выделенной строке. Создаёт копию темы с именем «{Название} (копия)» |

#### Панель поиска

| Элемент | Описание |
|---------|----------|
| **Поле поиска** | Input с иконкой лупы. Placeholder: «Поиск по названию…». Фильтрация в реальном времени по полю `name` |

#### Таблица тем

**Колонки:**

| # | Колонка | Описание | Сортировка |
|---|---------|----------|------------|
| 1 | **Название** | Текстовое название темы | Алфавитная |
| 2 | **Описание** | Краткое описание (обрезается при длинном тексте) | — |
| 3 | **Дата изменения** | Дата последнего редактирования (формат: ДД.ММ.ГГГГ ЧЧ:ММ) | По дате |
| 4 | **Кол-во элементов** | Количество добавленных элементов в теме | Числовая |

**Поведение строк:**

| Действие | Результат |
|----------|-----------|
| Hover | Подсветка строки |
| Одинарный клик | Выделение строки (активирует кнопки тулбара) |
| Двойной клик | Переход в конструктор темы (см. 8.2) |

#### Логика удаления

При нажатии [Удалить]:
1. Модальное окно: «Удалить тему «{name}»? Это действие нельзя отменить.»
2. Кнопки: «Отмена» / «Удалить» (деструктивная)
3. При подтверждении: тема удаляется, toast «Тема удалена»

#### Мок-данные

```typescript
// Дискриминированное объединение типов элементов темы
type ThemeElement =
  | { id: number; type: "image"; name: string; layout: { x: number; y: number; width: number; height: number } }
  | { id: number; type: "text"; name: string; content: string; layout: { x: number; y: number; width: number; height: number } }
  | { id: number; type: "animation"; name: string; controlId: number; controlName: string; hideByTimer: boolean; displayTime: number; animationDuration: number; animationType: string; layout: { x: number; y: number; width: number; height: number } }
  | { id: number; type: "hints"; name: string; settings: HintAreaSettings; elements: { id: number; type: string; name: string }[] }
  | { id: number; type: "advertise"; name: string; layout: { x: number; y: number; width: number; height: number } }

interface Theme {
  id: number
  name: string
  description: string
  updatedAt: string
  elementsCount: number
  elements: ThemeElement[]
}

// ⚠️ PLACEHOLDER — массив elements пуст для краткости.
// При инициализации приложения использовать ПОЛНЫЕ данные из раздела 8.5 (JSON с elements).
const initialThemes: Theme[] = [
  {
    id: 1,
    name: "Основная тема кофейни",
    description: "Стандартная тема с анимациями и подсказками",
    updatedAt: "10.02.2026 14:30",
    elementsCount: 4,
    elements: [] // заполняется в 8.5
  },
  {
    id: 2,
    name: "Акционная тема",
    description: "Тема для проведения промо-акций",
    updatedAt: "09.02.2026 10:15",
    elementsCount: 3,
    elements: []
  },
  {
    id: 3,
    name: "Минимальная тема",
    description: "Только заказ, без рекомендаций",
    updatedAt: "08.02.2026 09:00",
    elementsCount: 1,
    elements: []
  },
]
```

#### State управление

```typescript
const [themes, setThemes] = useState<Theme[]>(initialThemes)
const [selectedTheme, setSelectedTheme] = useState<Theme | null>(null)
const [searchQuery, setSearchQuery] = useState("")

const filteredThemes = themes.filter((theme) =>
  theme.name.toLowerCase().includes(searchQuery.toLowerCase())
)
```

---

### 8.2 Конструктор темы (экран редактирования)

**Открывается:** при создании новой темы или при двойном клике / кнопке [Редактировать] по существующей теме.

**Хлебные крошки:**  
`Настройки и обслуживание системы > Дисплей покупателя > Темы > {Название темы}`

> **Примечание:** При клике на «Темы» в хлебных крошках — возврат к списку тем (8.1).

---

#### 8.2.1 Layout конструктора

Конструктор темы занимает всю рабочую область и включает:

```
┌─────────────────────────────────────────────────────────────────────┐
│  Хлебные крошки: ... > Темы > {Название темы}                      │
├──────────────────────────────────────────────────────────────────────┤
│  Тулбар: [Название темы (input)] | [Описание (input)] | [Сохранить] │
├─────────────┬───────────────────────────────────┬────────────────────┤
│  Панель     │                                   │  Панель настроек  │
│  элементов  │     Canvas / Preview              │  (правая)         │
│  (левая)    │     Предпросмотр экрана CS        │                   │
│             │                                   │  Отображает       │
│  Дерево     │     Центральная область —          │  настройки        │
│  элементов  │     макет дисплея покупателя        │  выбранного       │
│             │     (пропорции реального экрана)    │  элемента         │
│             │                                   │                   │
│             │     [ Элементы размещаются         │                   │
│             │       на canvas перетаскиванием ]   │                   │
│             │                                   │                   │
├─────────────┴───────────────────────────────────┴────────────────────┤
│  Футер: [Отмена]                                        [Сохранить] │
└──────────────────────────────────────────────────────────────────────┘
```

**Компоненты конструктора:**

| Компонент | Расположение | Описание |
|-----------|-------------|----------|
| **Тулбар** | Верхняя полоса | Название темы (редактируемый input), описание (редактируемый input), кнопка «Сохранить» |
| **Панель элементов (левая)** | Левая боковая панель | Кнопка «Добавить элемент» + дерево добавленных элементов (иерархическое) |
| **Canvas / Preview** | Центральная область | Визуальный предпросмотр экрана CS. Пропорции реального дисплея. Добавленные элементы отображаются как прямоугольники с названиями |
| **Панель настроек (правая)** | Правая боковая панель | Настройки выбранного на canvas элемента: секции параметров, макет, граница и т.д. |
| **Футер** | Нижняя полоса | Кнопки «Отмена» (возврат к списку без сохранения) и «Сохранить» (сохранить + toast) |

#### 8.2.2 Тулбар конструктора

| Элемент | Тип | Описание |
|---------|-----|----------|
| **Название темы** | Input (текст) | Обязательное. Placeholder: «Введите название темы» |
| **Описание** | Input (текст) | Опциональное. Placeholder: «Краткое описание» |
| **Кнопка [Сохранить]** | Primary button | Сохраняет все изменения темы |

#### 8.2.3 Панель элементов (левая)

**Кнопка «Добавить элемент»:**  
При нажатии → выпадающий список (dropdown) с типами элементов:

| # | Элемент | Описание | Статус |
|---|---------|----------|--------|
| 1 | **Изображение** | Статичное изображение на экране CS | Существующий |
| 2 | **Текст** | Статичный текстовый блок | Существующий |
| 3 | **Рекламный блок** | Элемент рекламных кампаний (Advertise) | Существующий |
| 4 | **Анимации** | Элемент анимации добавления блюда | Существующий |
| 5 | **Подсказки** | 🆕 Элемент «Подсказки» — Область (Area) с контролами подсказок | **Новый** |

> **Правило:** Элемент «Подсказки» и элемент «Анимации» могут быть добавлены **не более одного раза** каждый. Если элемент уже добавлен — пункт в dropdown отображается серым (disabled) с tooltip: «Уже добавлен».

**Дерево добавленных элементов:**  
Иерархический список всех элементов в теме. Структура:

```
📋 Экран заказа
  ├── 🖼️ Изображение «Фон»
  ├── 📝 Текст «Заголовок»
  ├── 🎬 Анимации
  │     └── 📦 Контрол: «Анимация заказа»
  ├── 💡 Подсказки              ← 🆕 новый элемент
  │     ├── 📦 Контрол: «Подсказка кофе»
  │     └── 📦 Контрол: «Подсказка десерт»
  └── 📢 Рекламный блок
```

**Поведение дерева:**
- Клик по элементу → выделение на canvas + загрузка настроек в правой панели
- Перетаскивание (drag & drop) → изменение порядка элементов (влияет на Z-index)
- Иконка [X] справа — удаление элемента (с подтверждением)

#### 8.2.4 Canvas / Preview

**Назначение:** Визуальный предпросмотр экрана Customer Screen.

| Параметр | Значение |
|----------|----------|
| **Пропорции** | 16:9 (стандартный дисплей покупателя) |
| **Фон** | Тёмный (#1a1a2e) — имитирует фон дисплея |
| **Масштаб** | Автоматический (вписывается в доступную область с отступами) |

**Отображение элементов на canvas:**
- Каждый добавленный элемент отображается как **прямоугольная область** с пунктирной границей и названием
- При клике → выделяется (синяя рамка) → в правой панели появляются настройки
- Элемент `Подсказки` отображается как **большая область** с пунктирной границей и меткой «Подсказки (Область)»
- Внутри области «Подсказки» отображаются **превью контролов** с их элементами

**Визуальные обозначения типов элементов на canvas:**

| Элемент | Визуальное представление |
|---------|------------------------|
| Изображение | Прямоугольник с иконкой картинки и placeholder |
| Текст | Прямоугольник с предпросмотром текста |
| Рекламный блок | Прямоугольник с иконкой мегафона |
| Анимации | Прямоугольник с иконкой кинолёнки |
| **Подсказки** | Прямоугольник с пунктирной границей, иконкой лампочки и меткой «Подсказки (Область)». Внутри — превью размещённых контролов подсказок |

#### 8.2.5 Панель настроек (правая)

Содержимое зависит от выбранного элемента:

| Выбранный элемент | Содержимое правой панели |
|-------------------|------------------------|
| Ничего не выбрано | Пустое состояние: «Выберите элемент на canvas или в дереве элементов» |
| Изображение | Секции: Источник, Макет, Граница |
| Текст | Секции: Контент, Макет, Граница, Шрифт, Выравнивание |
| Рекламный блок | Секции: Параметры, Макет, Граница |
| Анимации | Секции: Параметры отображения, Выбор контрола, Макет, Граница |
| **Подсказки** | Секции: Параметры отображения, Область подсказок, Элементы, Макет, Граница — **см. подробно раздел 8.3** |

---

### 8.3 Элемент «Подсказки» в конструкторе темы (КЛЮЧЕВОЙ БЛОК)

> **Это основной новый элемент**, ради которого создаётся данный промт. Элемент «Подсказки» — это **контейнер (Область / Area)**, который добавляется в конструктор темы и отвечает за отображение подсказок на дисплее покупателя.

**Добавление:**
1. В конструкторе темы (8.2) нажать «Добавить элемент»
2. Выбрать «Подсказки» из выпадающего списка
3. На canvas появляется блок «Подсказки (Область)» с пунктирными границами
4. В правой панели загружаются настройки элемента

> **Визуальное поведение:** В конструкторе область видима (пунктирные границы). На реальном дисплее покупателя область **прозрачна** — видны только контролы подсказок при срабатывании триггеров (встреча 09.02: Руслан — «для клиента эта область не видна, это просто область»).

---

#### 8.3.1 Правая панель настроек — Секция «Параметры отображения»

Настройки анимации появления/исчезновения подсказок в Области.

| # | Настройка | Тип контрола | Значение по умолч. | Описание |
|---|-----------|-------------|---------------------|----------|
| 1 | **Скрыть по таймеру** | Toggle (чекбокс) | ☐ Выключен | Автоматическое скрытие **всего блока** Подсказок по таймеру. У Анимаций включён по умолчанию; у Подсказок — **выключен** (область видна пока триггер в чеке) |
| 2 | **Время отображения (сек)** | Number input | 10 | Доступно **только при включённом** «Скрыть по таймеру». Сколько секунд весь блок подсказок отображается |
| 3 | **Длительность анимации (сек)** | Number input | 0.5 | Скорость анимации появления/исчезновения отдельных подсказок |
| 4 | **Тип анимации** | Select (Single) | Fade In | Варианты: `Fade In` · `Slide Left` · `Slide Right` · `Slide Up` · `Slide Down` · `None` |

#### 8.3.2 Правая панель настроек — Секция «Область подсказок»

> **Уникальная секция для Подсказок.** Настройки контейнера (Area), определяющие поведение множественных подсказок. На основе архитектуры Arrivals с адаптацией для подсказок. Настройки специфичные для Arrivals (статусы, типы заказов, сортировка) — **исключены**.

| # | Настройка | Тип контрола | Значение по умолч. | Описание |
|---|-----------|-------------|---------------------|----------|
| 5 | **Режим области** | Select (Single) | Лист | В MVP доступен **только «Лист»**. Select заблокирован на одном значении (disabled). В будущем будет добавлен режим «Динамически заполняемая область» (встреча 09.02: Вадим — «можем пока лист сделать, это потом посмотрим по возможности») |
| 6 | **Направление заполнения** | Select (Single) | Горизонтально (→) | Как подсказки заполняют Область: **Горизонтально** (слева → направо) / **Вертикально** (сверху → вниз). Клиент настраивает сам (встреча 09.02: Руслан — «заполнение слева направо») |
| 7 | **Макс. количество столбцов** | Number input | 3 | Ограничение количества столбцов при горизонтальном заполнении. Настройка из Arrivals, сохранена (встреча 09.02: Михаил — «количество столбцов, да? Оставляем»). Значение 3 соответствует ориентиру MVP (3–4 подсказки одновременно) |
| 8 | **Межстрочный интервал (px)** | Number input | 8 | Отступ между строками подсказок. Настройка из Arrivals, сохранена (встреча 09.02: Руслан — «межстрочный интервал, межстолбцовый интервал — вот это всё остаётся»). Значение 8px согласовано с ФТ v0.9 |
| 9 | **Межстолбцовый интервал (px)** | Number input | 8 | Отступ между столбцами подсказок. Настройка из Arrivals, сохранена. Значение 8px согласовано с ФТ v0.9 |
| 10 | **Время жизни подсказки (сек)** | Number input | 30 | 🆕 **Новый параметр.** Сколько секунд одна подсказка отображается, прежде чем автоматически исчезнет. Клиент сам определяет время (встреча 09.02: Руслан — «нужно дать возможность управлять временем жизни этой подсказки, она должна на экране быть не сто лет») |
| 11 | **Макс. кол-во подсказок одновременно** | Number input | 3 | 🆕 **Новый параметр.** Максимум одновременно видимых подсказок в Области. Ориентир для MVP — 3–4 (встреча 09.02: Руслан — «ну 3-4 подсказки на заказ, я думаю это максимум») |
| 12 | **Поведение при удалении триггера** | Select (Single) | Убрать подсказку | Что происходит, если блюдо-триггер удалено из заказа: **«Убрать подсказку»** (по умолч.) / **«Оставить до конца заказа»** |

> **Настройки Arrivals, ИСКЛЮЧЁННЫЕ для подсказок:**
>
> | Исключённая настройка | Причина | Источник |
> |----------------------|---------|----------|
> | Расположение контролов (готовые выше/ниже) | Специфично для статусов заказов Arrivals | Встреча 09.02 |
> | Тип статуса заказа | Не применимо к подсказкам | Встреча 09.02: Михаил — «статусы кухни здесь не нужно» |
> | Статус заказа | Не применимо | Встреча 09.02 |
> | Отображать источники заказа | Не применимо | Встреча 09.02 |
> | Типы заказов | Не применимо | Встреча 09.02 |
> | Сортировка заказов | Не релевантно | Встреча 09.02: Руслан — «нет, наверное, не используем» |
> | Включить построчное чередование | Не релевантно для подсказок-баннеров | Решение аналитика |

#### 8.3.3 Правая панель настроек — Секция «Макет» (стандартная)

Позиционирование и размеры Области подсказок на canvas экрана CS.

| # | Настройка | Тип | Описание |
|---|-----------|-----|----------|
| 13 | **Позиция X** | Number (px) | Горизонтальное положение области на экране |
| 14 | **Позиция Y** | Number (px) | Вертикальное положение области на экране |
| 15 | **Ширина** | Number (px) | Ширина области |
| 16 | **Высота** | Number (px) | Высота области |
| 17 | **Отступы (padding)** | 4 × Number (px) | Внутренние отступы: сверху, справа, снизу, слева |

#### 8.3.4 Правая панель настроек — Секция «Граница» (стандартная)

Визуальное оформление рамки Области подсказок.

| # | Настройка | Тип | Описание |
|---|-----------|-----|----------|
| 18 | **Толщина рамки** | Number (px) | Толщина границы области |
| 19 | **Цвет рамки** | Color picker | Цвет границы |
| 20 | **Скругление** | Number (px) | Радиус скругления углов |
| 21 | **Тень** | Toggle + параметры | Включение тени с настройками (X offset, Y offset, Blur, Color) |

#### 8.3.5 Правая панель настроек — Секция «Элементы»

Управление вложенными элементами внутри Области подсказок.

**Кнопка «Добавить элемент»** → dropdown со списком из 16 доступных элементов (идентичен списку из раздела 7.3.5 — Контрол подсказки):

**Переиспользуемые из анимаций (10):**

| # | type | Название |
|---|------|----------|
| 1 | `area` | Область |
| 2 | `text` | Текст |
| 3 | `image` | Изображение |
| 4 | `product-image` | Изображение товара |
| 5 | `product-name` | Название продукта |
| 6 | `full-product-name` | Полное название продукта |
| 7 | `foreign-product-name` | Иностранное название продукта |
| 8 | `price` | Цена |
| 9 | `product-description` | Описание продукта |
| 10 | `foreign-product-description` | Описание товара (за рубежом) |

**Уникальные для подсказок (6):**

| # | type | Название | Описание |
|---|------|----------|----------|
| 11 | `hint-slogan` | Слоган подсказки | Динамический промо-текст из карточки подсказки |
| 12 | `hint-banner` | Баннер подсказки | Кастомная промо-картинка из карточки подсказки (если нет — стандартная заглушка) |
| 13 | `discount-name` | Название скидки | Название привязанной скидки (из справочника iiko) |
| 14 | `discount-size` | Размер скидки | % или сумма скидки |
| 15 | `discounted-price` | Цена со скидкой | Вычисляемое: Цена − Скидка |
| 16 | `old-price` | Старая цена | Цена до скидки (визуально перечёркнутая) |

> **📌 Сверка с задачей Sprint 3 (от PM):**
> Задача на фронтенд-разработчика содержит **7 ключевых элементов** контрола подсказки:
> 1. Слоган (текст) → `hint-slogan`
> 2. Изображение (картинка, при отсутствии — заглушка) → `hint-banner`
> 3. Название скидки (текст) → `discount-name`
> 4. Размер скидки (формат. сумма с валютой) → `discount-size`
> 5. Сумма без скидки (формат. сумма с валютой) → `old-price`
> 6. Сумма со скидкой (формат. сумма с валютой) → `discounted-price`
> 7. Элемент текст (как в контроле анимация) → `text`
>
> Все 7 элементов из задачи PM **полностью покрываются** списком из 16 элементов выше. Остальные 9 элементов (Область, Изображение, Изображение товара, Название/Полное название/Иностранное название продукта, Цена, Описания) — переиспользуемые из анимаций, их реализация уже существует.
>
> **Настраиваемые атрибуты (из задачи PM):** У каждого элемента контрола, **кроме изображения**, присутствуют атрибуты: **Макет, Граница, Шрифт**. Изображение (`hint-banner`, `image`, `product-image`) — только **Макет, Граница** (без Шрифта). Это соответствует правилам раздела 7.3.6.

**Кнопка «Очистить элементы»** — удаляет все вложенные элементы. Danger-кнопка с подтверждением: «Удалить все элементы?» → «Отмена» / «Очистить».

**Список добавленных элементов:**  
Каждый добавленный элемент отображается как строка/аккордеон:
- **Свёрнутый вид:** иконка типа + название + кнопка удаления [X]
- **Развёрнутый вид:** секции настроек элемента (Макет, Граница, Шрифт, Выравнивание — по правилам 7.3.6)
- **Drag & drop:** порядок элементов можно менять перетаскиванием

**Специфичные настройки вложенных элементов:**

| Элемент | Особенности |
|---------|------------|
| **Слоган подсказки** (`hint-slogan`) | Текст подтягивается автоматически из Справочника подсказок. В конструкторе отображается placeholder: «Слоган подсказки» |
| **Баннер подсказки** (`hint-banner`) | Изображение подтягивается из карточки подсказки. В конструкторе — placeholder-картинка. Если в карточке подсказки изображение не задано — стандартная заглушка |
| **Название скидки** (`discount-name`) | Текст подтягивается из справочника скидок iiko |
| **Размер скидки** (`discount-size`) | Форматированная сумма с валютой. Значение из справочника скидок |
| **Цена со скидкой** (`discounted-price`) | Вычисляется динамически: Цена блюда − Скидка. Формат: сумма с валютой |
| **Старая цена** (`old-price`) | Цена до скидки. Стиль по умолчанию — **зачёркнутый текст** (line-through). Формат: сумма с валютой |

#### 8.3.6 Z-индекс подсказок

> **Решение встречи 09.02:** Когда подсказка активна — Z-индекс Области подсказок **выше** рекламных кампаний (Advertise). Когда подсказок нет — Z-индекс **ниже** Advertise (область прозрачна, не перекрывает рекламу).

| Состояние | Z-индекс относительно Advertise |
|----------|-------------------------------|
| Подсказки присутствуют | **Выше** Advertise (подсказки поверх) |
| Подсказок нет | **Ниже** Advertise (область прозрачна) |

> **Примечание:** Реализация Z-индекса — задача **плагина** (не Admin панели). В прототипе v0 достаточно визуально показать элемент «Подсказки» поверх «Рекламного блока» на canvas.

#### 8.3.7 State элемента «Подсказки»

```typescript
interface HintAreaSettings {
  // Параметры отображения
  hideByTimer: boolean
  displayTime: number       // секунды
  animationDuration: number // секунды
  animationType: "fadeIn" | "slideLeft" | "slideRight" | "slideUp" | "slideDown" | "none"

  // Область подсказок
  areaMode: "list"           // MVP: только «Лист» (заблокировано)
  fillDirection: "horizontal" | "vertical"
  maxColumns: number
  rowGap: number             // px
  columnGap: number          // px
  hintLifetime: number       // секунды — время жизни одной подсказки
  maxHintsVisible: number    // макс. одновременно видимых подсказок
  triggerRemovalBehavior: "remove" | "keepUntilOrderEnd"

  // Макет
  layout: { x: number; y: number; width: number; height: number; padding: [number, number, number, number] }

  // Граница
  border: { width: number; color: string; radius: number; shadow: { enabled: boolean; x: number; y: number; blur: number; color: string } }

  // Примечание: вложенные элементы (ControlElement[]) хранятся на уровне ThemeElement.elements,
  // а не внутри settings — см. тип ThemeElement (type: "hints") в разделе 10.1
}

const defaultHintArea: HintAreaSettings = {
  hideByTimer: false,
  displayTime: 10,
  animationDuration: 0.5,
  animationType: "fadeIn",
  areaMode: "list",
  fillDirection: "horizontal",
  maxColumns: 3,
  rowGap: 8,
  columnGap: 8,
  hintLifetime: 30,
  maxHintsVisible: 3,
  triggerRemovalBehavior: "remove",
  layout: { x: 50, y: 400, width: 700, height: 200, padding: [8, 8, 8, 8] },
  border: { width: 0, color: "#CCCCCC", radius: 8, shadow: { enabled: false, x: 0, y: 2, blur: 4, color: "rgba(0,0,0,0.1)" } }
  // Примечание: поле elements[] не входит в HintAreaSettings — оно хранится на уровне ThemeElement (type: "hints").elements[]
}
```

#### 8.3.8 Интерактивные сценарии

**Сценарий: Добавление элемента «Подсказки» в тему**
1. Пользователь открывает тему «Основная тема кофейни» → конструктор (8.2)
2. В левой панели нажимает «Добавить элемент» → dropdown
3. Выбирает **«Подсказки»** → на canvas появляется прямоугольник с пунктирной рамкой и меткой «Подсказки (Область)»
4. Элемент автоматически выделен → в правой панели появляются настройки (8.3.1–8.3.5)
5. Пользователь задаёт «Направление заполнения» = Горизонтально, «Макс. количество» = 3
6. Добавляет вложенные элементы: «Баннер подсказки», «Слоган подсказки», «Цена со скидкой», «Старая цена»
7. Нажимает «Сохранить» → toast «Тема сохранена»

**Сценарий: Настройка области подсказок**
1. Пользователь кликает по блоку «Подсказки» на canvas → элемент выделен
2. В правой панели открывает секцию «Область подсказок»
3. Видит: «Режим области» = Лист (disabled, нельзя изменить)
4. Устанавливает: «Время жизни подсказки» = 15 сек, «Макс. количество» = 4
5. Меняет «Направление заполнения» → Вертикально (сверху → вниз)
6. Устанавливает «Межстрочный интервал» = 8 px
7. Выбирает «Поведение при удалении триггера» = «Оставить до конца заказа»

**Сценарий: Настройка вложенных элементов**
1. В секции «Элементы» нажимает «Добавить элемент» → dropdown (16 пунктов)
2. Выбирает «Слоган подсказки» → появляется в списке элементов
3. Раскрывает «Слоган подсказки» → видит секции: Макет, Граница, Шрифт, Выравнивание
4. Настраивает шрифт: Geist Sans, 18px, Жирный, Центр
5. Добавляет «Баннер подсказки» → раскрывает → видит секции: Макет, Граница (без Шрифт и Выравнивание — нетекстовый элемент)
6. Нажимает «Сохранить»

**Сценарий: Повторная попытка добавить «Подсказки»**
1. Элемент «Подсказки» уже добавлен в тему
2. Пользователь нажимает «Добавить элемент» → в dropdown пункт «Подсказки» отображается серым (disabled)
3. При наведении — tooltip: «Элемент «Подсказки» уже добавлен в тему»

---

### 8.4 Элемент «Анимации» в конструкторе темы (для сравнения)

> **Структура элемента «Анимации» аналогична** элементу «Подсказки» — описаны только отличия.

| Аспект | Анимации | Подсказки (8.3) |
|--------|---------|-----------------|
| Тип на canvas | Прямоугольник с иконкой кинолёнки | Прямоугольник с иконкой лампочки |
| Секция «Область» | **Отсутствует** — анимация показывает 1 pop-up | **Присутствует** — множество контролов в Области |
| Скрыть по таймеру (умолч.) | ☑ Включено | ☐ Выключено |
| Вложенные элементы | 15 элементов (10 общих + 5 уникальных анимации) | 16 элементов (10 общих + 6 уникальных подсказки) |
| Уникальные настройки области | — | Режим, Направление, Столбцы, Интервалы, Время жизни, Макс. количество, Поведение |
| Z-индекс | Стандартный | Динамический (выше Advertise при активности) |

---

### 8.5 Мок-данные тем (полные)

**Тема «Основная тема кофейни» (id: 1):**

```json
{
  "id": 1,
  "name": "Основная тема кофейни",
  "description": "Стандартная тема с анимациями и подсказками",
  "updatedAt": "10.02.2026 14:30",
  "elementsCount": 4,
  "elements": [
    {
      "id": 1,
      "type": "image",
      "name": "Фон",
      "layout": { "x": 0, "y": 0, "width": 1920, "height": 1080 }
    },
    {
      "id": 2,
      "type": "animation",
      "name": "Анимации",
      "controlId": 1,
      "controlName": "Анимация заказа",
      "hideByTimer": true,
      "displayTime": 5,
      "animationDuration": 0.3,
      "animationType": "fadeIn",
      "layout": { "x": 600, "y": 100, "width": 400, "height": 300 }
    },
    {
      "id": 3,
      "type": "hints",
      "name": "Подсказки",
      "settings": {
        "hideByTimer": false,
        "displayTime": 10,
        "animationDuration": 0.5,
        "animationType": "fadeIn",
        "areaMode": "list",
        "fillDirection": "horizontal",
        "maxColumns": 3,
        "rowGap": 8,
        "columnGap": 8,
        "hintLifetime": 30,
        "maxHintsVisible": 3,
        "triggerRemovalBehavior": "remove",
        "layout": { "x": 50, "y": 750, "width": 1820, "height": 280, "padding": [8, 8, 8, 8] },
        "border": { "width": 0, "color": "#CCCCCC", "radius": 8, "shadow": { "enabled": false, "x": 0, "y": 0, "blur": 0, "color": "rgba(0,0,0,0)" } }
      },
      "elements": [
        { "id": 1, "type": "hint-banner", "name": "Баннер подсказки" },
        { "id": 2, "type": "hint-slogan", "name": "Слоган подсказки" },
        { "id": 3, "type": "product-name", "name": "Название продукта" },
        { "id": 4, "type": "discounted-price", "name": "Цена со скидкой" },
        { "id": 5, "type": "old-price", "name": "Старая цена" },
        { "id": 6, "type": "discount-name", "name": "Название скидки" }
      ]
    },
    {
      "id": 4,
      "type": "advertise",
      "name": "Рекламный блок",
      "layout": { "x": 50, "y": 400, "width": 1820, "height": 300 }
    }
  ]
}
```

**Тема «Акционная тема» (id: 2):**

```json
{
  "id": 2,
  "name": "Акционная тема",
  "description": "Тема для проведения промо-акций",
  "updatedAt": "09.02.2026 10:15",
  "elementsCount": 3,
  "elements": [
    {
      "id": 1,
      "type": "image",
      "name": "Фон промо",
      "layout": { "x": 0, "y": 0, "width": 1920, "height": 1080 }
    },
    {
      "id": 2,
      "type": "hints",
      "name": "Подсказки",
      "settings": {
        "hideByTimer": false,
        "displayTime": 10,
        "animationDuration": 0.3,
        "animationType": "slideUp",
        "areaMode": "list",
        "fillDirection": "vertical",
        "maxColumns": 1,
        "rowGap": 12,
        "columnGap": 0,
        "hintLifetime": 20,
        "maxHintsVisible": 4,
        "triggerRemovalBehavior": "keepUntilOrderEnd",
        "layout": { "x": 1400, "y": 100, "width": 480, "height": 880, "padding": [12, 12, 12, 12] },
        "border": { "width": 1, "color": "#E5E7EB", "radius": 12, "shadow": { "enabled": true, "x": 0, "y": 4, "blur": 12, "color": "rgba(0,0,0,0.15)" } }
      },
      "elements": [
        { "id": 1, "type": "hint-banner", "name": "Баннер подсказки" },
        { "id": 2, "type": "hint-slogan", "name": "Слоган подсказки" },
        { "id": 3, "type": "discount-size", "name": "Размер скидки" },
        { "id": 4, "type": "discounted-price", "name": "Цена со скидкой" }
      ]
    },
    {
      "id": 3,
      "type": "advertise",
      "name": "Рекламный блок",
      "layout": { "x": 50, "y": 100, "width": 1300, "height": 880 }
    }
  ]
}
```

**Тема «Минимальная тема» (id: 3):**

```json
{
  "id": 3,
  "name": "Минимальная тема",
  "description": "Только заказ, без рекомендаций",
  "updatedAt": "08.02.2026 09:00",
  "elementsCount": 1,
  "elements": [
    {
      "id": 1,
      "type": "image",
      "name": "Фон минимальный",
      "layout": { "x": 0, "y": 0, "width": 1920, "height": 1080 }
    }
  ]
}
```

---

## 9. Раздел «Настройки терминалов» — Колонка «Подсказки»

> **Расширение** существующего экрана «Настройки терминалов». Добавляется новая колонка **«Подсказки»** — по аналогии с колонкой «Рекламные кампании» (Advertise). Назначение определяет, какие подсказки из справочника будут загружены в кэш плагина конкретного терминала.

---

### 9.1 Экран настроек терминалов

**Местоположение в навигации:**  
Сайдбар → Экраны → Дисплей покупателя → **Настройки терминалов**

**Хлебные крошки:**  
`Настройки и обслуживание системы > Дисплей покупателя > Настройки терминалов`

---

#### 9.1.1 Структура таблицы

Таблица представляет собой **матрицу назначений**: строки — терминалы (кассы), колонки — функциональные блоки.

**Порядок колонок (слева направо):**

| # | Колонка | Описание | Статус |
|---|---------|----------|--------|
| 1 | **Терминал** | Название кассы/терминала | Существующая |
| 2 | **Тема** | Назначенная тема CS | Существующая |
| 3 | **Рекл. кампании** | Назначенные рекламные кампании (чекбоксы) | Существующая |
| 4 | **Подсказки** | 🆕 Назначенные подсказки (чекбоксы) | **Новая** |

> **Порядок:** Тема → Компания → Подсказка (встреча 09.02: Руслан — «не будем менять порядок — тема, компания и потом подсказка»).

#### 9.1.2 Колонка «Подсказки»

**Структура колонки:**

| Элемент | Описание |
|---------|----------|
| **Заголовок колонки** | «Подсказки» — текст жирным |
| **Подзаголовки** | Каждая подсказка из справочника — отдельная подколонка с названием (повёрнутым вертикально или горизонтально — определяется по скриншотам) |
| **Чекбоксы** | На пересечении строки (терминал) и подколонки (подсказка) — чекбокс назначения (✅ / ☐) |

**Поведение:**
- Клик по чекбоксу → переключает назначение подсказки на терминал
- Изменения **не сохраняются автоматически** — нужно нажать кнопку «Сохранить» в тулбаре
- При сохранении → toast «Настройки терминалов сохранены»

**Визуальная структура таблицы:**

```
┌───────────────┬────────────┬─────────────────────┬──────────────────────────────────────────────┐
│               │            │  Рекл. кампании     │  Подсказки                                   │
│  Терминал     │   Тема     ├───────┬──────┬──────┼────────┬────────┬────────┬──────┬────────────┤
│               │            │Кампан.│Кампан│Кампан│Пирожок │Десерт  │Сок к   │Суп  │Комбо-      │
│               │            │  1    │  2   │  3   │к кофе  │к обеду │завтраку│дня  │обед        │
├───────────────┼────────────┼───────┼──────┼──────┼────────┼────────┼────────┼──────┼────────────┤
│ Касса 1 (Зал) │ Основная   │  ✅   │  ✅  │  ☐  │   ✅   │   ✅   │   ☐   │  ✅  │    ☐      │
│ Касса 2 (Зал) │ Основная   │  ✅   │  ☐   │  ☐  │   ✅   │   ☐   │   ✅   │  ☐  │    ✅      │
│ Касса 3 (Тер.)│ Акционная  │  ☐   │  ✅  │  ✅  │   ✅   │   ✅   │   ✅   │  ✅  │    ✅      │
│ Касса 4 (С.о.)│ Минимальная│  ☐   │  ☐   │  ☐  │   ☐   │   ☐   │   ☐   │  ☐  │    ☐      │
└───────────────┴────────────┴───────┴──────┴──────┴────────┴────────┴────────┴──────┴────────────┘
```

#### 9.1.3 Тулбар

| Элемент | Описание |
|---------|----------|
| **Заголовок** | «Настройки терминалов» |
| **Кнопка [Сохранить]** | Сохраняет все изменения назначений |

> **Примечание:** Кнопки «Добавить» и «Удалить» на этом экране отсутствуют — терминалы управляются в другом разделе iikoWeb. Здесь только назначение функциональных блоков.

---

### 9.2 Мок-данные

```typescript
interface Terminal {
  id: number
  name: string
  themeId: number
  themeName: string
  campaigns: number[]     // id назначенных рекламных кампаний
  hints: number[]         // id назначенных подсказок
}

interface Campaign {
  id: number
  name: string
}

interface HintAssignment {
  id: number
  name: string
}

const campaigns: Campaign[] = [
  { id: 1, name: "Кампания «Завтраки»" },
  { id: 2, name: "Кампания «Обеды»" },
  { id: 3, name: "Кампания «Вечер»" },
]

const hintsForTerminals: HintAssignment[] = [
  { id: 1, name: "Пирожок к кофе" },
  { id: 2, name: "Десерт к обеду" },
  { id: 3, name: "Сок к завтраку" },
  { id: 4, name: "Суп дня" },
  { id: 5, name: "Комбо-обед" },
]

const initialTerminals: Terminal[] = [
  { id: 1, name: "Касса 1 (Зал)", themeId: 1, themeName: "Основная тема кофейни", campaigns: [1, 2], hints: [1, 2, 4] },
  { id: 2, name: "Касса 2 (Зал)", themeId: 1, themeName: "Основная тема кофейни", campaigns: [1], hints: [1, 3, 5] },
  { id: 3, name: "Касса 3 (Терраса)", themeId: 2, themeName: "Акционная тема", campaigns: [2, 3], hints: [1, 2, 3, 4, 5] },
  { id: 4, name: "Касса 4 (Самообслуживание)", themeId: 3, themeName: "Минимальная тема", campaigns: [], hints: [] },
]
```

#### State управление

```typescript
const [terminals, setTerminals] = useState<Terminal[]>(initialTerminals)

const toggleHintAssignment = (terminalId: number, hintId: number) => {
  setTerminals((prev) =>
    prev.map((t) =>
      t.id === terminalId
        ? {
            ...t,
            hints: t.hints.includes(hintId)
              ? t.hints.filter((id) => id !== hintId)
              : [...t.hints, hintId],
          }
        : t
    )
  )
}
```

---

### 9.3 Интерактивные сценарии

**Сценарий: Назначение подсказки на терминал**
1. Пользователь открывает «Настройки терминалов»
2. Видит таблицу с 4 терминалами и колонкой «Подсказки» (5 подколонок)
3. Ставит чекбокс на пересечении «Касса 4» × «Пирожок к кофе» → чекбокс = ✅
4. Нажимает «Сохранить» → toast «Настройки терминалов сохранены»

**Сценарий: Снятие назначения**
1. Видит, что «Касса 3» × «Суп дня» = ✅
2. Снимает чекбокс → ☐
3. Нажимает «Сохранить»

**Сценарий: Обзор назначений**
1. Пользователь прокручивает таблицу горизонтально (если подсказок много — скролл)
2. Видит полную матрицу: какие подсказки на каких терминалах
3. Замечает, что «Касса 4» не имеет ни одной подсказки — при необходимости назначает

---

## 10. Сводные мок-данные (Шаг 4)

> **Назначение:** Консолидированный раздел, объединяющий все мок-данные из разделов 7 (Контролы), 8 (Темы), 9 (Терминалы) и добавляющий **недостающую сущность «Подсказки» (Hints)** — справочник подсказок допродажи с привязкой к визуальным шаблонам (Контролам).
>
> Все сущности связаны между собой через `id`-ссылки. Данные реалистичны и основаны на контексте кофейни. При добавлении новых сущностей в прототип v0 — использовать данные из этого раздела как единый источник истины.
>
> **Карта разделов:**
> - **10.1** — TypeScript-интерфейсы всех сущностей
> - **10.2** — Подсказки (справочник) — 🆕 новая сущность
> - **10.3** — Контролы (полные, с элементами и настройками)
> - **10.4** — Темы (полные) — ссылка на 8.5
> - **10.5** — Терминалы (полные) — ссылка на 9.2
> - **10.6** — Карта связей между сущностями
> - **10.7** — Вспомогательные справочники (кампании, продукты, скидки)

---

### 10.1 TypeScript-интерфейсы

Полный набор интерфейсов всех сущностей системы Customer Screen Admin Panel. Интерфейсы упорядочены от «листовых» (без зависимостей) к «корневым» (ссылаются на другие).

```typescript
// ─────────────────────────────────────────────
// Вспомогательные типы
// ─────────────────────────────────────────────

/** Элемент дерева продуктов (меню iiko) */
interface ProductNode {
  id: number
  name: string
  type: "category" | "product"
  children?: ProductNode[]
}

/** Триггер подсказки — блюдо или категория, при добавлении которой в заказ срабатывает подсказка */
interface TriggerItem {
  id: number
  name: string
  type: "category" | "product"
}

/** Рекомендуемое блюдо — то, что предлагается клиенту */
interface RecommendationItem {
  id: number
  name: string
  type: "product"
}

/** Рекламная кампания (существующая сущность iikoWeb) */
interface Campaign {
  id: number
  name: string
}

// ─────────────────────────────────────────────
// Контролы (визуальные шаблоны)
// ─────────────────────────────────────────────

/** Элемент контрола — визуальный компонент внутри шаблона */
interface ControlElement {
  id: number
  type: string                  // из таблицы элементов (7.3.5 / 7.4)
  name: string                  // отображаемое название
  settings: {
    layout: {
      x: number
      y: number
      width: number
      height: number
      padding: [number, number, number, number]   // top, right, bottom, left
    }
    border: {
      width: number
      radius: number
    }
    font?: {                   // только для текстовых элементов
      family: string
      size: number
      bold: boolean
      italic: boolean
    }
    align?: "left" | "center" | "right"   // только для текстовых элементов
  }
}

/** Контрол — визуальный шаблон для анимации или подсказки */
interface Control {
  id: number
  name: string
  type: "animation" | "hint"
  elementsCount: number
  elements: ControlElement[]
}

// ─────────────────────────────────────────────
// Подсказки (справочник допродаж)
// ─────────────────────────────────────────────

/** Подсказка — запись справочника допродаж */
interface Hint {
  id: number
  name: string
  status: "active" | "scheduled" | "expired"
  period: {
    startDate: string          // формат YYYY-MM-DD
    endDate: string
  }
  time: {
    startTime: string          // формат HH:MM
    endTime: string
  }
  slogan: string               // промо-текст (отображается в элементе hint-slogan)
  discountType: "percent" | "fixed"
  discountValue: number        // % или сумма
  iikoDiscount: string | null  // название скидки из справочника iiko (или null)
  triggers: TriggerItem[]      // при выборе каких блюд/категорий срабатывает
  recommendation: RecommendationItem | null   // рекомендуемое блюдо
  image: string | null         // URL картинки (баннер подсказки)
  imageSource: "menu" | "gallery" | "uploaded" | null
  // Поведение image + imageSource:
  // - imageSource="uploaded"/"gallery" + image=URL → отображается указанное изображение
  // - imageSource="menu" + image=null → изображение подтягивается из карточки recommendation-продукта в iiko (URL вычисляется на лету)
  // - imageSource=null + image=null → баннер не отображается (элемент hint-banner скрыт)
  controlId: number | null       // 🆕 ссылка на Control.id с type="hint" — визуальный шаблон подсказки (null если контрол был удалён)
}

// ─────────────────────────────────────────────
// Темы (конструктор макетов CS)
// ─────────────────────────────────────────────

/** Настройки области подсказок внутри темы */
interface HintAreaSettings {
  hideByTimer: boolean
  displayTime: number                // секунды
  animationDuration: number          // секунды
  animationType: "fadeIn" | "slideLeft" | "slideRight" | "slideUp" | "slideDown" | "none"
  areaMode: "list"                   // MVP: только «Лист»
  fillDirection: "horizontal" | "vertical"
  maxColumns: number
  rowGap: number                     // px
  columnGap: number                  // px
  hintLifetime: number               // секунды — время жизни одной подсказки
  maxHintsVisible: number            // макс. одновременно видимых подсказок
  triggerRemovalBehavior: "remove" | "keepUntilOrderEnd"
  layout: {
    x: number; y: number; width: number; height: number
    padding: [number, number, number, number]
  }
  border: {
    width: number; color: string; radius: number
    shadow: { enabled: boolean; x: number; y: number; blur: number; color: string }
  }
}

/** Дискриминированное объединение типов элементов темы */
type ThemeElement =
  | { id: number; type: "image"; name: string; layout: { x: number; y: number; width: number; height: number } }
  | { id: number; type: "text"; name: string; content: string; layout: { x: number; y: number; width: number; height: number } }
  | { id: number; type: "animation"; name: string; controlId: number; controlName: string; hideByTimer: boolean; displayTime: number; animationDuration: number; animationType: string; layout: { x: number; y: number; width: number; height: number } }
  | { id: number; type: "hints"; name: string; settings: HintAreaSettings; elements: { id: number; type: string; name: string }[] }
  | { id: number; type: "advertise"; name: string; layout: { x: number; y: number; width: number; height: number } }

/** Тема — визуальный макет экрана Customer Screen */
interface Theme {
  id: number
  name: string
  description: string
  updatedAt: string               // формат ДД.ММ.ГГГГ ЧЧ:ММ
  elementsCount: number
  elements: ThemeElement[]
}

// ─────────────────────────────────────────────
// Терминалы (настройки назначений)
// ─────────────────────────────────────────────

/** Терминал — касса / точка обслуживания */
interface Terminal {
  id: number
  name: string
  themeId: number                // → Theme.id
  themeName: string
  campaigns: number[]            // → Campaign.id[]
  hints: number[]                // → Hint.id[]
}

/** Проекция подсказки для колонки назначений в терминалах (см. 9.2) */
interface HintAssignment {
  id: number                     // → Hint.id
  name: string                   // → Hint.name — отображается как заголовок подколонки
}
```

---

### 10.2 Подсказки (Справочник)

> **🆕 Новая сущность.** Справочник подсказок — записи допродаж, каждая из которых привязана к визуальному шаблону (Контролу подсказки). При срабатывании триггера плагин подставляет данные подсказки (слоган, скидку, изображение, рекомендуемое блюдо) в шаблон контрола и отображает результат в Области подсказок темы.
>
> **Связь с Контролами:** Поле `controlId` ссылается на `Control.id` с `type = "hint"`. Доступные контролы: id 4 («Подсказка кофе»), id 5 («Подсказка десерт»), id 6 («Подсказка скидка»). Выбор контрола определяет, какие визуальные элементы будут использоваться при отображении подсказки.
>
> **Связь с Терминалами:** Подсказки назначаются на терминалы через матрицу чекбоксов (раздел 9). Поле `Terminal.hints[]` содержит массив `Hint.id`.

```typescript
const initialHints: Hint[] = [
  {
    id: 1,
    name: "Пирожок к кофе",
    status: "active",
    period: { startDate: "2026-01-01", endDate: "2026-06-30" },
    time: { startTime: "08:00", endTime: "12:00" },
    slogan: "Не забудьте купить пирожок! При покупке с кофе — скидка 15%",
    discountType: "percent",
    discountValue: 15,
    iikoDiscount: "Скидка на выпечку к кофе",
    triggers: [
      { id: 1, name: "Кофейные напитки", type: "category" },
      { id: 15, name: "Латте большой", type: "product" }
    ],
    recommendation: { id: 32, name: "Пирожок вишнёвый", type: "product" },
    image: "/cherry-pastry.jpg",
    imageSource: "gallery",
    controlId: 4   // → Контрол «Подсказка кофе» (product-image, product-name, hint-slogan, discount-name, discounted-price, old-price)
  },
  {
    id: 2,
    name: "Десерт к обеду",
    status: "scheduled",
    period: { startDate: "2026-03-01", endDate: "2026-05-31" },
    time: { startTime: "12:00", endTime: "15:00" },
    slogan: "Побалуйте себя десертом! Чизкейк со скидкой к обеду",
    discountType: "fixed",
    discountValue: 50,
    iikoDiscount: "Скидка на десерт к обеду",
    triggers: [
      { id: 5, name: "Обеденное меню", type: "category" },
      { id: 51, name: "Бизнес-ланч", type: "product" }
    ],
    recommendation: { id: 42, name: "Чизкейк", type: "product" },
    image: "/classic-cheesecake.png",
    imageSource: "gallery",
    controlId: 5   // → Контрол «Подсказка десерт» (hint-banner, hint-slogan, price, discount-size)
  },
  {
    id: 3,
    name: "Сок к завтраку",
    status: "active",
    period: { startDate: "2026-01-15", endDate: "2026-12-31" },
    time: { startTime: "07:00", endTime: "11:00" },
    slogan: "Свежевыжатый сок — идеальное начало утра! Скидка 20% к завтраку",
    discountType: "percent",
    discountValue: 20,
    iikoDiscount: "Утренняя скидка на напитки",
    triggers: [
      { id: 6, name: "Завтраки", type: "category" },
      { id: 31, name: "Круассан", type: "product" }
    ],
    recommendation: { id: 61, name: "Апельсиновый фреш", type: "product" },
    image: null,
    imageSource: "menu",
    controlId: 6   // → Контрол «Подсказка скидка» (area, product-image, full-product-name, hint-slogan, hint-banner, discount-name, discounted-price)
  },
  {
    id: 4,
    name: "Суп дня",
    status: "active",
    period: { startDate: "2026-02-01", endDate: "2026-04-30" },
    time: { startTime: "11:30", endTime: "16:00" },
    slogan: "Согрейтесь супом дня! Томатный крем-суп всего за 199 ₽",
    discountType: "fixed",
    discountValue: 100,
    iikoDiscount: "Скидка на суп к основному блюду",
    triggers: [
      { id: 7, name: "Салаты и супы", type: "category" },
      { id: 52, name: "Паста Карбонара", type: "product" },
      { id: 53, name: "Стейк из курицы", type: "product" }
    ],
    recommendation: { id: 71, name: "Томатный крем-суп", type: "product" },
    image: null,
    imageSource: null,
    controlId: 4   // → Контрол «Подсказка кофе» (переиспользуется шаблон с ценами)
  },
  {
    id: 5,
    name: "Комбо-обед",
    status: "active",
    period: { startDate: "2026-01-10", endDate: "2026-12-31" },
    time: { startTime: "12:00", endTime: "16:00" },
    slogan: "Собери комбо-обед! Суп + горячее + напиток = скидка 25%",
    discountType: "percent",
    discountValue: 25,
    iikoDiscount: "Комбо-обед 25%",
    triggers: [
      { id: 5, name: "Обеденное меню", type: "category" }
    ],
    recommendation: null,
    image: "/combo-lunch-banner.png",
    imageSource: "uploaded",
    controlId: 5   // → Контрол «Подсказка десерт» (hint-banner, hint-slogan, price, discount-size)
  }
]
```

**Сводная таблица подсказок:**

| id | Название | Статус | Период | Время | Контрол (controlId) | Триггеры | Рекомендация |
|----|----------|--------|--------|-------|---------------------|----------|--------------|
| 1 | Пирожок к кофе | active | 01.01–30.06.2026 | 08:00–12:00 | **4** — «Подсказка кофе» | Кофейные напитки, Латте большой | Пирожок вишнёвый |
| 2 | Десерт к обеду | scheduled | 01.03–31.05.2026 | 12:00–15:00 | **5** — «Подсказка десерт» | Обеденное меню, Бизнес-ланч | Чизкейк |
| 3 | Сок к завтраку | active | 15.01–31.12.2026 | 07:00–11:00 | **6** — «Подсказка скидка» | Завтраки, Круассан | Апельсиновый фреш |
| 4 | Суп дня | active | 01.02–30.04.2026 | 11:30–16:00 | **4** — «Подсказка кофе» | Салаты и супы, Паста Карбонара, Стейк из курицы | Томатный крем-суп |
| 5 | Комбо-обед | active | 10.01–31.12.2026 | 12:00–16:00 | **5** — «Подсказка десерт» | Обеденное меню | — (нет конкретного блюда) |

---

### 10.3 Контролы (полные)

> Консолидированные данные из разделов 7.3.9 и 7.4. Ниже представлены **все 6 контролов** с полными данными элементов, включая настройки `settings` (layout, border, font, align).

#### Контролы анимации (3 шт.)

```typescript
const controlAnimation1: Control = {
  id: 1,
  name: "Анимация заказа",
  type: "animation",
  elementsCount: 5,
  elements: [
    {
      id: 1, type: "area", name: "Область",
      settings: {
        layout: { x: 0, y: 0, width: 400, height: 300, padding: [0, 0, 0, 0] },
        border: { width: 0, radius: 12 }
      }
    },
    {
      id: 2, type: "product-image", name: "Изображение товара",
      settings: {
        layout: { x: 20, y: 20, width: 150, height: 150, padding: [0, 0, 0, 0] },
        border: { width: 0, radius: 8 }
      }
    },
    {
      id: 3, type: "product-name", name: "Название продукта",
      settings: {
        layout: { x: 190, y: 20, width: 190, height: 40, padding: [4, 8, 4, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 18, bold: true, italic: false },
        align: "left"
      }
    },
    {
      id: 4, type: "price", name: "Цена",
      settings: {
        layout: { x: 190, y: 70, width: 100, height: 30, padding: [4, 8, 4, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 16, bold: false, italic: false },
        align: "left"
      }
    },
    {
      id: 5, type: "last-added-dish", name: "Последнее добавленное блюдо",
      settings: {
        layout: { x: 190, y: 110, width: 190, height: 30, padding: [4, 8, 4, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 14, bold: false, italic: true },
        align: "left"
      }
    }
  ]
}

const controlAnimation2: Control = {
  id: 2,
  name: "Анимация добавления",
  type: "animation",
  elementsCount: 3,
  elements: [
    {
      id: 1, type: "product-image", name: "Изображение товара",
      settings: {
        layout: { x: 0, y: 0, width: 200, height: 200, padding: [0, 0, 0, 0] },
        border: { width: 1, radius: 12 }
      }
    },
    {
      id: 2, type: "full-product-name", name: "Полное название продукта",
      settings: {
        layout: { x: 0, y: 210, width: 200, height: 40, padding: [4, 0, 4, 0] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 16, bold: true, italic: false },
        align: "center"
      }
    },
    {
      id: 3, type: "quantity", name: "Количество продукции",
      settings: {
        layout: { x: 0, y: 260, width: 200, height: 30, padding: [2, 0, 2, 0] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 14, bold: false, italic: false },
        align: "center"
      }
    }
  ]
}

const controlAnimation3: Control = {
  id: 3,
  name: "Промо-анимация",
  type: "animation",
  elementsCount: 4,
  elements: [
    {
      id: 1, type: "image", name: "Изображение",
      settings: {
        layout: { x: 0, y: 0, width: 300, height: 180, padding: [0, 0, 0, 0] },
        border: { width: 0, radius: 8 }
      }
    },
    {
      id: 2, type: "text", name: "Текст",
      settings: {
        layout: { x: 0, y: 190, width: 300, height: 30, padding: [4, 8, 4, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 14, bold: false, italic: false },
        align: "center"
      }
    },
    {
      id: 3, type: "product-name", name: "Название продукта",
      settings: {
        layout: { x: 0, y: 230, width: 300, height: 30, padding: [4, 8, 4, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 18, bold: true, italic: false },
        align: "center"
      }
    },
    {
      id: 4, type: "price", name: "Цена",
      settings: {
        layout: { x: 0, y: 270, width: 300, height: 30, padding: [4, 8, 4, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 16, bold: true, italic: false },
        align: "center"
      }
    }
  ]
}
```

#### Контролы подсказок (3 шт.)

```typescript
const controlHint4: Control = {
  id: 4,
  name: "Подсказка кофе",
  type: "hint",
  elementsCount: 6,
  elements: [
    {
      id: 1, type: "product-image", name: "Изображение товара",
      settings: {
        layout: { x: 10, y: 10, width: 120, height: 120, padding: [0, 0, 0, 0] },
        border: { width: 0, radius: 8 }
      }
    },
    {
      id: 2, type: "product-name", name: "Название продукта",
      settings: {
        layout: { x: 140, y: 10, width: 200, height: 30, padding: [4, 8, 4, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 16, bold: true, italic: false },
        align: "left"
      }
    },
    {
      id: 3, type: "hint-slogan", name: "Слоган подсказки",
      settings: {
        layout: { x: 140, y: 45, width: 200, height: 40, padding: [2, 8, 2, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 13, bold: false, italic: true },
        align: "left"
      }
    },
    {
      id: 4, type: "discount-name", name: "Название скидки",
      settings: {
        layout: { x: 140, y: 90, width: 200, height: 20, padding: [2, 8, 2, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 12, bold: false, italic: false },
        align: "left"
      }
    },
    {
      id: 5, type: "discounted-price", name: "Цена со скидкой",
      settings: {
        layout: { x: 140, y: 115, width: 100, height: 25, padding: [2, 8, 2, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 18, bold: true, italic: false },
        align: "left"
      }
    },
    {
      id: 6, type: "old-price", name: "Старая цена",
      settings: {
        layout: { x: 250, y: 115, width: 90, height: 25, padding: [2, 8, 2, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 14, bold: false, italic: false },
        align: "left"
      }
    }
  ]
}

const controlHint5: Control = {
  id: 5,
  name: "Подсказка десерт",
  type: "hint",
  elementsCount: 4,
  elements: [
    {
      id: 1, type: "hint-banner", name: "Баннер подсказки",
      settings: {
        layout: { x: 0, y: 0, width: 350, height: 160, padding: [0, 0, 0, 0] },
        border: { width: 0, radius: 12 }
      }
    },
    {
      id: 2, type: "hint-slogan", name: "Слоган подсказки",
      settings: {
        layout: { x: 10, y: 170, width: 330, height: 40, padding: [4, 8, 4, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 16, bold: true, italic: false },
        align: "center"
      }
    },
    {
      id: 3, type: "price", name: "Цена",
      settings: {
        layout: { x: 10, y: 220, width: 160, height: 25, padding: [2, 8, 2, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 18, bold: true, italic: false },
        align: "right"
      }
    },
    {
      id: 4, type: "discount-size", name: "Размер скидки",
      settings: {
        layout: { x: 180, y: 220, width: 160, height: 25, padding: [2, 8, 2, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 16, bold: true, italic: false },
        align: "left"
      }
    }
  ]
}

const controlHint6: Control = {
  id: 6,
  name: "Подсказка скидка",
  type: "hint",
  elementsCount: 7,
  elements: [
    {
      id: 1, type: "area", name: "Область",
      settings: {
        layout: { x: 0, y: 0, width: 380, height: 260, padding: [8, 8, 8, 8] },
        border: { width: 1, radius: 12 }
      }
    },
    {
      id: 2, type: "product-image", name: "Изображение товара",
      settings: {
        layout: { x: 10, y: 10, width: 140, height: 140, padding: [0, 0, 0, 0] },
        border: { width: 0, radius: 8 }
      }
    },
    {
      id: 3, type: "full-product-name", name: "Полное название продукта",
      settings: {
        layout: { x: 160, y: 10, width: 210, height: 35, padding: [4, 8, 4, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 16, bold: true, italic: false },
        align: "left"
      }
    },
    {
      id: 4, type: "hint-slogan", name: "Слоган подсказки",
      settings: {
        layout: { x: 160, y: 50, width: 210, height: 50, padding: [2, 8, 2, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 13, bold: false, italic: true },
        align: "left"
      }
    },
    {
      id: 5, type: "hint-banner", name: "Баннер подсказки",
      settings: {
        layout: { x: 10, y: 160, width: 360, height: 90, padding: [0, 0, 0, 0] },
        border: { width: 0, radius: 8 }
      }
    },
    {
      id: 6, type: "discount-name", name: "Название скидки",
      settings: {
        layout: { x: 160, y: 105, width: 210, height: 20, padding: [2, 8, 2, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 12, bold: false, italic: false },
        align: "left"
      }
    },
    {
      id: 7, type: "discounted-price", name: "Цена со скидкой",
      settings: {
        layout: { x: 160, y: 130, width: 120, height: 25, padding: [2, 8, 2, 8] },
        border: { width: 0, radius: 0 },
        font: { family: "Geist Sans", size: 18, bold: true, italic: false },
        align: "left"
      }
    }
  ]
}
```

#### Сводный массив контролов

```typescript
const initialControls: Control[] = [
  controlAnimation1,  // id:1 — Анимация заказа
  controlAnimation2,  // id:2 — Анимация добавления
  controlAnimation3,  // id:3 — Промо-анимация
  controlHint4,       // id:4 — Подсказка кофе
  controlHint5,       // id:5 — Подсказка десерт
  controlHint6,       // id:6 — Подсказка скидка
]
```

---

### 10.4 Темы (полные)

> Полные мок-данные тем представлены в **разделе 8.5** — три темы с полной структурой элементов (image, animation, hints, advertise). Ниже — краткая сводка для навигации.

| id | Название | Элементы | Область подсказок | Направление |
|----|----------|----------|-------------------|-------------|
| 1 | Основная тема кофейни | image, animation, hints, advertise | Да — горизонтальное, 3 столбца, 30 сек | horizontal |
| 2 | Акционная тема | image, hints, advertise | Да — вертикальное, 1 столбец, 20 сек | vertical |
| 3 | Минимальная тема | image | Нет (только фон) | — |

**📌 Полные данные:** см. раздел 8.5 данного документа.

---

### 10.5 Терминалы (полные)

> Полные мок-данные терминалов представлены в **разделе 9.2** — четыре терминала с назначениями тем, кампаний и подсказок. Ниже — краткая сводка.

| id | Название | Тема (themeId) | Кампании | Подсказки (hint ids) |
|----|----------|----------------|----------|----------------------|
| 1 | Касса 1 (Зал) | 1 — Основная | 1, 2 | **1** (Пирожок к кофе), **2** (Десерт к обеду), **4** (Суп дня) |
| 2 | Касса 2 (Зал) | 1 — Основная | 1 | **1** (Пирожок к кофе), **3** (Сок к завтраку), **5** (Комбо-обед) |
| 3 | Касса 3 (Терраса) | 2 — Акционная | 2, 3 | **1, 2, 3, 4, 5** (все подсказки) |
| 4 | Касса 4 (Самообсл.) | 3 — Минимальная | — | — (нет подсказок, т.к. тема без области) |

**📌 Полные данные:** см. раздел 9.2 данного документа.

---

### 10.6 Карта связей между сущностями

> Таблица перекрёстных ссылок — какие сущности на какие ссылаются и через какие поля. Используется для валидации целостности данных и реализации навигации между экранами.

#### 10.6.1 Граф зависимостей

```
Terminal
  ├── themeId ────────→ Theme.id
  ├── campaigns[] ────→ Campaign.id
  └── hints[] ────────→ Hint.id
                          └── controlId ──→ Control.id (type="hint")
                                              └── elements[] ──→ ControlElement[]

Theme
  └── elements[]
        ├── type:"animation" → controlId ──→ Control.id (type="animation")
        └── type:"hints"     → elements[] (элементы области — шаблон отображения)
```

#### 10.6.2 Матрица связей

| Сущность-источник | Поле-ссылка | Сущность-цель | Поле-цель | Тип связи | Пример |
|-------------------|-------------|---------------|-----------|-----------|--------|
| **Hint** | `controlId` | **Control** | `id` (type="hint") | Many → One | Hint(1).controlId=4 → Control(4) «Подсказка кофе» |
| **Terminal** | `hints[]` | **Hint** | `id` | Many → Many | Terminal(1).hints=[1,2,4] → Hint(1), Hint(2), Hint(4) |
| **Terminal** | `themeId` | **Theme** | `id` | Many → One | Terminal(1).themeId=1 → Theme(1) «Основная тема кофейни» |
| **Terminal** | `campaigns[]` | **Campaign** | `id` | Many → Many | Terminal(3).campaigns=[2,3] → Campaign(2), Campaign(3) |
| **Theme** (elem) | `controlId` (animation) | **Control** | `id` (type="animation") | Many → One | Theme(1).elements[1].controlId=1 → Control(1) «Анимация заказа» |

#### 10.6.3 Таблица перекрёстных ссылок: Подсказки ↔ Контролы ↔ Терминалы

| Подсказка (Hint) | Контрол (controlId) | Терминалы (назначена на) |
|-------------------|---------------------|--------------------------|
| id:1 «Пирожок к кофе» | **4** — «Подсказка кофе» | Касса 1, Касса 2, Касса 3 |
| id:2 «Десерт к обеду» | **5** — «Подсказка десерт» | Касса 1, Касса 3 |
| id:3 «Сок к завтраку» | **6** — «Подсказка скидка» | Касса 2, Касса 3 |
| id:4 «Суп дня» | **4** — «Подсказка кофе» | Касса 1, Касса 3 |
| id:5 «Комбо-обед» | **5** — «Подсказка десерт» | Касса 2, Касса 3 |

#### 10.6.4 Таблица перекрёстных ссылок: Терминалы ↔ Темы ↔ Область подсказок

| Терминал | Тема (themeId) | Есть область подсказок? | Направление | Макс. видимых | Подсказки на терминале |
|----------|----------------|------------------------|-------------|---------------|----------------------|
| Касса 1 (id:1) | 1 — Основная | ✅ Да | horizontal | 3 | 3 шт. (id: 1, 2, 4) |
| Касса 2 (id:2) | 1 — Основная | ✅ Да | horizontal | 3 | 3 шт. (id: 1, 3, 5) |
| Касса 3 (id:3) | 2 — Акционная | ✅ Да | vertical | 4 | 5 шт. (id: 1, 2, 3, 4, 5) |
| Касса 4 (id:4) | 3 — Минимальная | ❌ Нет | — | — | 0 шт. |

> **⚠️ Касса 4:** Тема «Минимальная» не содержит элемента «Подсказки» — даже если назначить подсказки на этот терминал, они не будут отображаться. В UI можно показать предупреждение.

---

### 10.7 Вспомогательные справочники

Данные внешних справочников, используемые в мок-данных подсказок, терминалов и продуктового селектора.

#### 10.7.1 Рекламные кампании (Campaign)

```typescript
const campaigns: Campaign[] = [
  { id: 1, name: "Кампания «Завтраки»" },
  { id: 2, name: "Кампания «Обеды»" },
  { id: 3, name: "Кампания «Вечер»" },
]
```

#### 10.7.2 Дерево продуктов (меню iiko)

> Используется в ProductSelector (компонент выбора триггеров и рекомендаций). Содержит категории и продукты, используемые в триггерах и рекомендациях подсказок.

```typescript
const productTree: ProductNode[] = [
  {
    id: 1, name: "Кофейные напитки", type: "category",
    children: [
      { id: 11, name: "Эспрессо", type: "product" },
      { id: 12, name: "Американо", type: "product" },
      { id: 13, name: "Латте", type: "product" },
      { id: 14, name: "Капучино", type: "product" },
      { id: 15, name: "Латте большой", type: "product" }
    ]
  },
  {
    id: 2, name: "Чай", type: "category",
    children: [
      { id: 21, name: "Чёрный чай", type: "product" },
      { id: 22, name: "Зелёный чай", type: "product" },
      { id: 23, name: "Травяной чай", type: "product" }
    ]
  },
  {
    id: 3, name: "Выпечка", type: "category",
    children: [
      { id: 31, name: "Круассан", type: "product" },
      { id: 32, name: "Пирожок вишнёвый", type: "product" },
      { id: 33, name: "Пирожок с мясом", type: "product" },
      { id: 34, name: "Булочка с корицей", type: "product" }
    ]
  },
  {
    id: 4, name: "Десерты", type: "category",
    children: [
      { id: 41, name: "Тирамису", type: "product" },
      { id: 42, name: "Чизкейк", type: "product" },
      { id: 43, name: "Мороженое", type: "product" }
    ]
  },
  {
    id: 5, name: "Обеденное меню", type: "category",
    children: [
      { id: 51, name: "Бизнес-ланч", type: "product" },
      { id: 52, name: "Паста Карбонара", type: "product" },
      { id: 53, name: "Стейк из курицы", type: "product" },
      { id: 54, name: "Ризотто с грибами", type: "product" }
    ]
  },
  {
    id: 6, name: "Завтраки", type: "category",
    children: [
      { id: 61, name: "Апельсиновый фреш", type: "product" },
      { id: 62, name: "Яичница с беконом", type: "product" },
      { id: 63, name: "Овсянка с ягодами", type: "product" },
      { id: 64, name: "Тост с авокадо", type: "product" }
    ]
  },
  {
    id: 7, name: "Салаты и супы", type: "category",
    children: [
      { id: 71, name: "Томатный крем-суп", type: "product" },
      { id: 72, name: "Цезарь с курицей", type: "product" },
      { id: 73, name: "Греческий салат", type: "product" }
    ]
  }
]
```

#### 10.7.3 Скидки iiko (используемые в подсказках)

> Внешний справочник скидок системы iiko. В мок-данных — только те скидки, которые привязаны к подсказкам через поле `iikoDiscount`.

```typescript
interface IikoDiscount {
  id: number
  name: string
  type: "percent" | "fixed"
  value: number
}

const iikoDiscounts: IikoDiscount[] = [
  { id: 101, name: "Скидка на выпечку к кофе", type: "percent", value: 15 },
  { id: 102, name: "Скидка на десерт к обеду", type: "fixed", value: 50 },
  { id: 103, name: "Утренняя скидка на напитки", type: "percent", value: 20 },
  { id: 104, name: "Скидка на суп к основному блюду", type: "fixed", value: 100 },
  { id: 105, name: "Комбо-обед 25%", type: "percent", value: 25 },
]
```

#### 10.7.4 Изображения (галерея)

> Placeholder-изображения для прототипа v0. Используются в подсказках (`image`) и в компоненте ImageSelector.

```typescript
const galleryImages: string[] = [
  "/golden-croissant.png",        // круассан
  "/cherry-pastry.jpg",            // пирожок с вишней — используется в Hint(1)
  "/coffee-cup.png",               // чашка кофе
  "/decadent-chocolate-cake.png",  // шоколадный торт
  "/colorful-fruit-tart.png",     // фруктовый тарт
  "/single-cinnamon-roll.png",    // булочка с корицей
  "/classic-tiramisu.png",        // тирамису
  "/classic-cheesecake.png",      // чизкейк — используется в Hint(2)
  "/combo-lunch-banner.png",      // баннер комбо-обед — используется в Hint(5)
]
```

---

## 11. Сквозные интерактивные сценарии (Шаг 4)

> Предыдущие разделы описывали интерактивность **внутри каждого раздела** (7.3.10, 8.3.8, 9.3). В данном разделе описаны **сквозные пользовательские сценарии (end-to-end)**, которые пересекают несколько разделов Admin панели. Цель — продемонстрировать, как администратор кофейни выполняет реальные бизнес-задачи, последовательно перемещаясь между разделами: Подсказки → Контролы → Темы → Настройки терминалов. Все сценарии используют мок-данные из разделов 7–10 и работают с единым in-memory state прототипа.

---

### 11.1 Сценарий: Полная настройка подсказок с нуля

**Контекст:** Кофейня только что подключила Customer Screen. Администратор хочет настроить механизм подсказок — от создания первой подсказки до её отображения на кассе. Сейчас в системе нет ни одной подсказки, но есть терминалы и базовая тема.

**Предусловия:**
- Терминалы уже заведены в системе (Касса 1–4)
- Тема «Минимальная тема» (id: 3) существует, но не содержит элемента «Подсказки»
- Справочник подсказок пуст
- Справочник контролов содержит только контролы анимаций

**Шаги:**

| # | Действие | Раздел | Описание | Ссылка |
|---|----------|--------|----------|--------|
| 1 | Перейти в раздел «Подсказки» | Сайдбар → Дисплей покупателя → **Подсказки** | В сайдбаре кликнуть по пункту «Подсказки». Открывается справочник — пустая таблица с сообщением «Подсказки не найдены» | 6A |
| 2 | Создать подсказку | Подсказки → тулбар → **[+ Добавить]** | Нажать [+ Добавить]. Открывается drawer создания подсказки. Заполнить: Название = «Пирожок к кофе», Дата начала = сегодня, Дата окончания = через 30 дней. Добавить триггер: группа «Кофейные напитки». Добавить рекомендацию: блюдо «Пирожок с вишней». Выбрать скидку: «Скидка 15% на выпечку». Загрузить изображение. Нажать **«Сохранить»** → toast «Подсказка сохранена» | 6A |
| 3 | Перейти в раздел «Контролы» | Сайдбар → Дисплей покупателя → **Контролы** | Кликнуть на «Контролы» в сайдбаре. Открывается справочник контролов с 3 контролами анимаций | 7.1 |
| 4 | Создать контрол подсказки | Контролы → тулбар → **[+ Добавить]** | Нажать [+ Добавить] → открывается диалог выбора типа. Кликнуть по карточке **«Контрол подсказки»** → диалог закрывается, открывается drawer | 7.2 |
| 5 | Настроить контрол | Drawer контрола | Ввести название: «Шаблон промо-подсказки». Нажать «Добавить элемент» → выбрать из dropdown: «Баннер подсказки», «Слоган подсказки», «Название продукта», «Цена со скидкой», «Старая цена». Раскрыть «Слоган подсказки» → Шрифт: 18px, Жирный, Центр. Нажать **«Сохранить»** → toast «Контрол сохранён» → в таблице появилась строка «Шаблон промо-подсказки» с типом «Подсказка» | 7.3 |
| 6 | Перейти в раздел «Темы» | Сайдбар → Дисплей покупателя → **Темы** | Кликнуть на «Темы» в сайдбаре. Открывается справочник тем с 3 темами | 8.1 |
| 7 | Открыть конструктор темы | Темы → двойной клик по «Минимальная тема» | Двойной клик по строке → открывается конструктор темы. На canvas — только фоновое изображение | 8.2 |
| 8 | Добавить элемент «Подсказки» | Конструктор → левая панель → **«Добавить элемент»** → **«Подсказки»** | Нажать «Добавить элемент», выбрать «Подсказки». На canvas появляется прямоугольник «Подсказки (Область)» с пунктирной рамкой. В правой панели загружаются настройки | 8.3 |
| 9 | Настроить область подсказок | Конструктор → правая панель настроек | Установить: Направление заполнения = Горизонтально, Макс. столбцов = 3, Время жизни = 20 сек, Макс. подсказок = 3. В секции «Элементы» добавить: «Баннер подсказки», «Слоган подсказки», «Цена со скидкой», «Старая цена». Настроить Макет области: X=50, Y=750, Ширина=1820, Высота=280. Нажать **«Сохранить»** → toast «Тема сохранена» | 8.3.1, 8.3.2, 8.3.5 |
| 10 | Перейти в «Настройки терминалов» | Сайдбар → Дисплей покупателя → **Настройки терминалов** | Кликнуть на «Настройки терминалов» в сайдбаре. В таблице появилась новая подколонка «Пирожок к кофе» в группе «Подсказки» | 9.1 |
| 11 | Назначить подсказку на терминалы | Настройки терминалов → колонка «Подсказки» | Поставить чекбоксы на пересечении: «Касса 1 (Зал)» × «Пирожок к кофе» = ✅, «Касса 2 (Зал)» × «Пирожок к кофе» = ✅. Нажать **«Сохранить»** → toast «Настройки терминалов сохранены» | 9.1.2 |

**Результат:**
- В справочнике подсказок — 1 подсказка «Пирожок к кофе» со статусом «Активна»
- В справочнике контролов — новый контрол «Шаблон промо-подсказки» типа «Подсказка» с 5 элементами
- Тема «Минимальная тема» содержит элемент «Подсказки (Область)» с настройками
- На Кассе 1 и Кассе 2 назначена подсказка «Пирожок к кофе»
- На реальном дисплее: при добавлении кофе в заказ — покажется баннер «Пирожок к кофе»

---

### 11.2 Сценарий: Быстрое добавление новой подсказки к существующей настройке

**Контекст:** В кофейне стартует новая акция: «При покупке салата — скидка на суп дня». Администратору нужно быстро добавить подсказку и развернуть её на нужные кассы. Контрол и тема уже настроены.

**Предусловия:**
- Контрол подсказки «Подсказка кофе» (id: 4) существует
- Тема «Основная тема кофейни» (id: 1) содержит элемент «Подсказки» с настроенной областью
- Терминалы Касса 1–3 используют темы с элементом «Подсказки»

**Шаги:**

| # | Действие | Раздел | Описание | Ссылка |
|---|----------|--------|----------|--------|
| 1 | Перейти в «Подсказки» | Сайдбар → Дисплей покупателя → **Подсказки** | Открывается справочник подсказок с существующими записями | 6A |
| 2 | Создать подсказку | Подсказки → **[+ Добавить]** | Нажать [+ Добавить]. Заполнить drawer: Название = «Суп дня к салату», Даты = сегодня–через 14 дней, Время = 11:00–15:00 (только обед). Триггер: категория «Салаты и супы». Рекомендация: блюдо «Томатный крем-суп». Скидка: «Скидка на суп к основному блюду». Нажать **«Сохранить»** → toast «Подсказка сохранена» | 6A |
| 3 | Перейти в «Настройки терминалов» | Сайдбар → Дисплей покупателя → **Настройки терминалов** | Открывается таблица. В колонке «Подсказки» появилась новая подколонка «Суп дня к салату» | 9.1 |
| 4 | Назначить на кассы | Настройки терминалов → колонка «Подсказки» | Поставить чекбоксы: «Касса 1» × «Суп дня к салату» = ✅, «Касса 3» × «Суп дня к салату» = ✅. Нажать **«Сохранить»** → toast «Настройки терминалов сохранены» | 9.1.2 |

**Результат:**
- Новая подсказка «Суп дня к салату» в справочнике со статусом «Активна»
- Подсказка назначена на Кассу 1 и Кассу 3
- Контрол и тема **не затрагивались** — они уже настроены ранее
- Всего 4 шага, ~2 минуты работы администратора

---

### 11.3 Сценарий: Изменение визуального шаблона подсказки

**Контекст:** Владелец кофейни просит изменить внешний вид подсказок: добавить отображение размера скидки и убрать старую цену. Администратор редактирует контрол подсказки.

**Предусловия:**
- Контрол «Подсказка кофе» (id: 4) существует с элементами: Изображение товара, Название продукта, Слоган подсказки, Название скидки, Цена со скидкой, Старая цена (6 элементов)
- Контрол используется в теме «Основная тема кофейни»

**Шаги:**

| # | Действие | Раздел | Описание | Ссылка |
|---|----------|--------|----------|--------|
| 1 | Перейти в «Контролы» | Сайдбар → Дисплей покупателя → **Контролы** | Открывается справочник контролов | 7.1 |
| 2 | Отфильтровать по типу | Контролы → фильтр | Нажать кнопку-переключатель **«Подсказки»** в панели фильтрации. В таблице остаются только контролы типа «Подсказка» | 7.1 |
| 3 | Открыть контрол | Контролы → двойной клик по «Подсказка кофе» | Открывается drawer редактирования. В заголовке: «Подсказка кофе», бейдж «Подсказка» (read-only). В панели «Элементы» — 6 добавленных элементов | 7.3 |
| 4 | Удалить элемент «Старая цена» | Drawer → панель «Элементы» | Найти элемент «Старая цена» в списке. Нажать кнопку [X] справа от элемента → элемент удалён из списка | 7.3.4 |
| 5 | Добавить элемент «Размер скидки» | Drawer → **«Добавить элемент»** → dropdown | Нажать «Добавить элемент», выбрать **«Размер скидки»** из выпадающего списка. Элемент добавлен в конец списка | 7.3.5 |
| 6 | Настроить шрифт нового элемента | Drawer → раскрыть «Размер скидки» | Раскрыть аккордеон «Размер скидки». Секция «Шрифт»: Размер = 24px, Жирный = ✅, Выравнивание = Центр | 7.3.6 |
| 7 | Изменить порядок элементов | Drawer → drag & drop | Перетащить «Размер скидки» выше «Цена со скидкой» — чтобы скидка отображалась перед ценой | 7.3.4 |
| 8 | Сохранить | Drawer → **«Сохранить»** | Нажать «Сохранить» → toast «Контрол сохранён» → drawer закрывается → в таблице «Подсказка кофе» — elementsCount обновлён | 7.3.7 |

**Результат:**
- Контрол «Подсказка кофе» содержит обновлённый набор элементов: Изображение товара, Название продукта, Слоган подсказки, Название скидки, **Размер скидки** (новый), Цена со скидкой
- Элемент «Старая цена» удалён
- Изменение автоматически влияет на все темы, использующие этот контрол

---

### 11.4 Сценарий: Обзор текущих назначений

**Контекст:** Администратор хочет проверить, какие подсказки назначены на какие кассы, и убедиться, что на Кассе 4 (самообслуживание) нет лишних подсказок.

**Предусловия:**
- Система настроена: подсказки, контролы, темы, терминалы — всё из мок-данных (разделы 7–10)

**Шаги:**

| # | Действие | Раздел | Описание | Ссылка |
|---|----------|--------|----------|--------|
| 1 | Перейти в «Настройки терминалов» | Сайдбар → Дисплей покупателя → **Настройки терминалов** | Открывается таблица-матрица: 4 терминала × (Тема + Рекл. кампании + Подсказки) | 9.1 |
| 2 | Проверить назначения Кассы 4 | Строка «Касса 4 (Самообслуживание)» | Видно: Тема = «Минимальная тема», все чекбоксы рекламных кампаний = ☐, все чекбоксы подсказок = ☐. Касса 4 чиста — корректно | 9.1.2 |
| 3 | Проверить Кассу 3 | Строка «Касса 3 (Терраса)» | Видно: Тема = «Акционная тема», все 5 подсказок назначены (✅). Администратор считает, что 5 подсказок — перебор | 9.1.2 |
| 4 | Перейти в «Подсказки» для просмотра деталей | Сайдбар → Дисплей покупателя → **Подсказки** | Открывается справочник подсказок. Просмотр статусов (Активна / Запланирована / Истекла) | 6A |
| 5 | Проверить подсказку «Комбо-обед» | Подсказки → клик по «Комбо-обед» | Открывается drawer с деталями. Администратор видит, что акция заканчивается завтра | 6A |
| 6 | Вернуться в «Настройки терминалов» | Сайдбар → Дисплей покупателя → **Настройки терминалов** | Открывается таблица назначений | 9.1 |
| 7 | Снять лишние назначения | Колонка «Подсказки» | Снять чекбоксы: «Касса 3» × «Комбо-обед» = ☐, «Касса 3» × «Сок к завтраку» = ☐ | 9.1.2 |
| 8 | Сохранить изменения | **«Сохранить»** | Toast «Настройки терминалов сохранены» | 9.1.3 |

**Результат:**
- Администратор получил полную картину назначений по всем кассам
- С Кассы 3 сняты 2 подсказки: «Комбо-обед» и «Сок к завтраку»
- На Кассе 3 осталось 3 подсказки (вместо 5)

---

### 11.5 Сценарий: Удаление подсказки и очистка зависимостей

**Контекст:** Акция «Комбо-обед» завершена, администратор хочет полностью удалить подсказку.

**Предусловия:**
- Подсказка «Комбо-обед» (id: 5) существует, назначена на Кассу 2 и Кассу 3

**Шаги:**

| # | Действие | Раздел | Описание | Ссылка |
|---|----------|--------|----------|--------|
| 1 | Предварительная проверка | Сайдбар → **Настройки терминалов** | Администратор видит, где назначена «Комбо-обед»: ✅ у Кассы 2 и Кассы 3 | 9.1 |
| 2 | Перейти в «Подсказки» | Сайдбар → **Подсказки** | Открывается справочник подсказок | 6A |
| 3 | Выделить подсказку | Клик по строке «Комбо-обед» | Строка выделена — кнопки тулбара активны | 6A |
| 4 | Инициировать удаление | Тулбар → **[Удалить]** | Модальное окно: **«Удалить подсказку «Комбо-обед»? Подсказка будет снята со всех терминалов.»** Кнопки: «Отмена» / «Удалить» | 6A |
| 5 | Подтвердить удаление | **«Удалить»** | Подсказка удалена → toast «Подсказка удалена» | 6A |
| 6 | Проверить терминалы | Сайдбар → **Настройки терминалов** | Подколонка «Комбо-обед» **исчезла** из группы «Подсказки». Назначения автоматически сняты | 9.1 |

**Результат:**
- Подсказка «Комбо-обед» полностью удалена из системы
- Подколонка «Комбо-обед» исчезла из таблицы настроек терминалов
- Назначения на Кассу 2 и Кассу 3 автоматически очищены
- Контролы и темы **не затронуты**

> **Для v0:** При удалении подсказки из state `hints` необходимо также удалить её `id` из массива `hints` каждого терминала в state `terminals` (каскадная очистка — см. 11.8).

---

### 11.6 Сценарий: Создание новой темы с подсказками

**Контекст:** Кофейня открывает летнюю веранду с отдельным терминалом. Администратор создаёт новую тему с крупными подсказками, вертикальным расположением и увеличенным временем жизни.

**Предусловия:**
- Контролы подсказок уже созданы (из мок-данных)
- Подсказки существуют в справочнике (5 штук)
- Терминал «Касса 3 (Терраса)» пока использует тему «Акционная тема»

**Шаги:**

| # | Действие | Раздел | Описание | Ссылка |
|---|----------|--------|----------|--------|
| 1 | Перейти в «Темы» | Сайдбар → **Темы** | Открывается справочник тем с 3 темами | 8.1 |
| 2 | Создать новую тему | Тулбар → **[+ Добавить]** | Открывается конструктор с пустым canvas | 8.2 |
| 3 | Заполнить метаданные | Тулбар конструктора | Название = «Тема для веранды», Описание = «Летняя тема с крупными подсказками» | 8.2.2 |
| 4 | Добавить фон | **«Добавить элемент»** → **«Изображение»** | Настроить Макет: X=0, Y=0, Ширина=1920, Высота=1080 | 8.2.3 |
| 5 | Добавить «Подсказки» | **«Добавить элемент»** → **«Подсказки»** | На canvas появляется блок «Подсказки (Область)» | 8.3 |
| 6 | Параметры отображения | Правая панель → секция «Параметры отображения» | Длительность анимации = 0.3 сек, Тип анимации = Slide Up | 8.3.1 |
| 7 | Область подсказок | Правая панель → секция «Область подсказок» | Направление = **Вертикально**, Столбцы = 1, Интервал = 12 px, Время жизни = 45 сек, Макс. подсказок = 4, При удалении триггера = «Оставить до конца заказа» | 8.3.2 |
| 8 | Макет области | Правая панель → секция «Макет» | X=1400, Y=100, Ширина=480, Высота=880 (правая сторона экрана) | 8.3.3 |
| 9 | Вложенные элементы | Правая панель → секция «Элементы» | Добавить: «Баннер подсказки», «Название продукта», «Слоган подсказки», «Размер скидки», «Цена со скидкой». Настроить шрифты | 8.3.5 |
| 10 | Сохранить тему | **«Сохранить»** | Toast «Тема сохранена» → возврат к списку тем | 8.1 |
| 11 | Назначить тему | Сайдбар → **Настройки терминалов** | В строке «Касса 3» изменить «Тема» на **«Тема для веранды»**. Сохранить | 9.1 |
| 12 | Назначить подсказки | Колонка «Подсказки» | «Касса 3» × «Пирожок к кофе» = ✅, × «Десерт к обеду» = ✅, × «Суп дня» = ✅. Сохранить | 9.1.2 |

**Результат:**
- Создана тема «Тема для веранды» с вертикальной областью подсказок
- Область настроена: 45 сек время жизни, вертикаль, до 4 подсказок
- Тема назначена на Кассу 3, 3 подсказки активированы

---

### 11.7 Карта переходов между разделами

При настройке подсказок администратор перемещается между четырьмя разделами через **сайдбар**.

**Типовые маршруты:**

| Цель | Маршрут | Количество переходов |
|------|---------|---------------------|
| **Полная настройка с нуля** | Подсказки → Контролы → Темы → Настройки терминалов | 4 раздела, 3 перехода |
| **Быстрое добавление подсказки** | Подсказки → Настройки терминалов | 2 раздела, 1 переход |
| **Изменение внешнего вида** | Контролы (редактирование drawer) | 1 раздел, 0 переходов |
| **Обзор назначений** | Настройки терминалов (→ опц. Подсказки для деталей) | 1–2 раздела |
| **Создание темы** | Темы (конструктор) → Настройки терминалов | 2 раздела, 1 переход |

**Внутренние переходы (не через сайдбар):**

| Переход | Триггер | State |
|---------|---------|-------|
| Список тем → Конструктор | Двойной клик / кнопка [Редактировать] | `activeSection` → `themeEditor`, `editingThemeId` = id темы |
| Конструктор → Список тем | Хлебные крошки «Темы» / кнопка «Отмена» / «Сохранить» | `activeSection` → `themes` |

**Правила:**
1. Несохранённые изменения теряются при переходе — Standard iikoWeb behavior
2. Активный пункт сайдбара подсвечивается
3. Хлебные крошки обновляются при каждом переходе (раздел 4.2)
4. Конструктор тем — подраздел внутри «Темы», не отдельный пункт сайдбара

---

### 11.8 Ожидаемое поведение state в v0

> Все разделы Admin панели работают с **единым in-memory store**. Изменения в одном разделе должны быть **немедленно видны** в других разделах.

#### Структура единого state

```typescript
interface AppState {
  // Навигация
  activeSection: "hints" | "controls" | "themes" | "themeEditor" | "terminals"
  
  // Справочник подсказок (раздел 6A)
  hints: Hint[]
  selectedHint: Hint | null
  
  // Справочник контролов (раздел 7)
  controls: Control[]
  selectedControl: Control | null
  controlFilter: "all" | "animation" | "hint"
  
  // Темы (раздел 8)
  themes: Theme[]
  selectedTheme: Theme | null
  editingThemeId: number | null  // id темы, открытой в конструкторе
  
  // Настройки терминалов (раздел 9)
  terminals: Terminal[]
  
  // Вспомогательные данные
  campaigns: Campaign[]
  searchQueries: { hints: string; controls: string; themes: string }
}
```

#### Правила синхронизации между разделами

| Действие в одном разделе | Влияние на другие разделы | Механизм |
|--------------------------|--------------------------|----------|
| **Создание подсказки** (Подсказки) | Новая подколонка в «Настройки терминалов» → колонка «Подсказки» | Терминалы генерируют подколонки из `hints` динамически |
| **Удаление подсказки** (Подсказки) | Подколонка исчезает из «Настройки терминалов», назначения очищаются | `terminals[].hints` фильтруется каскадно |
| **Создание контрола** (Контролы) | Контрол доступен для выбора в конструкторе Тем | Конструктор загружает `controls.filter(c => c.type === 'hint')` |
| **Удаление контрола** (Контролы) | Ссылки в темах очищаются | `themes[].elements` фильтруется |
| **Изменение темы** (Темы) | Название обновляется в колонке «Тема» в терминалах | Отображение через `themes.find(t => t.id === terminal.themeId).name` |
| **Изменение назначений** (Терминалы) | Без обратного влияния | Конечная точка назначения |

#### Обработчик удаления подсказки (каскадная синхронизация)

```typescript
const deleteHint = (hintId: number) => {
  setAppState(prev => ({
    ...prev,
    hints: prev.hints.filter(h => h.id !== hintId),
    selectedHint: prev.selectedHint?.id === hintId ? null : prev.selectedHint,
    // Каскадно снять назначения со всех терминалов
    terminals: prev.terminals.map(t => ({
      ...t,
      hints: t.hints.filter(id => id !== hintId)
    }))
  }))
}
```

#### Обработчик удаления контрола (каскадная синхронизация)

```typescript
const deleteControl = (controlId: number) => {
  setAppState(prev => ({
    ...prev,
    controls: prev.controls.filter(c => c.id !== controlId),
    selectedControl: prev.selectedControl?.id === controlId ? null : prev.selectedControl,
    // Очистить ссылки в темах
    themes: prev.themes.map(theme => ({
      ...theme,
      elements: theme.elements.filter(el =>
        !(('controlId' in el) && el.controlId === controlId)
      ),
      elementsCount: theme.elements.filter(el =>
        !(('controlId' in el) && el.controlId === controlId)
      ).length
    })),
    // Обнулить controlId в подсказках, ссылающихся на удаляемый контрол
    hints: prev.hints.map(h =>
      h.controlId === controlId ? { ...h, controlId: null } : h
    )
  }))
}
```

#### Переключение разделов

```typescript
const navigateToSection = (section: AppState["activeSection"]) => {
  setAppState(prev => ({
    ...prev,
    activeSection: section,
    // Сбросить выделение при переходе
    ...(section === "controls" && { selectedControl: null }),
    ...(section === "themes" && { selectedTheme: null, editingThemeId: null }),
    ...(section === "hints" && { selectedHint: null }),
  }))
}
```

#### Инициализация

```typescript
const [appState, setAppState] = useState<AppState>({
  activeSection: "hints",
  hints: initialHints,           // мок-данные из раздела 10.2
  selectedHint: null,
  controls: initialControls,     // мок-данные из раздела 10.3
  selectedControl: null,
  controlFilter: "all",
  themes: initialThemes,         // мок-данные из раздела 8.5
  selectedTheme: null,
  editingThemeId: null,
  terminals: initialTerminals,   // мок-данные из раздела 9.2
  campaigns: campaigns,          // мок-данные из раздела 10.7.1
  searchQueries: { hints: "", controls: "", themes: "" },
})
```

> **Важно для v0:** Все `useState` из разделов 7–9 должны быть **подняты** (lifted up) в единый корневой state или React Context. Нельзя использовать изолированные `useState` внутри каждого раздела — иначе изменения не будут видны между разделами. Альтернативно — использовать `useReducer` с единым reducer.


# Промт-патч v1.12: Правки П-7, П-8, П-9 — таймеры авто-уборки, статистика Б5, маркетинг через плагин

---
**Версия**: 1.12
**Дата**: 2026-02-26
**Автор**: Кирилл Тюрин (системный аналитик)
**Статус**: [PENDING]
**Артефакт**: Д3-патч (Промт-патч для обновления прототипа iikoWeb)
**Базовый документ**: Промт_прототипа_PUDU_Admin_панели_v1.11_патч.md (v1.11, 2026-02-26)
**Источники**: SPEC-002 v1.20 (разделы 7.4, 7.6a, 13); стенограмма встречи 18.02.2026; `2026-02-26-правки-SPEC-002-по-встрече-18-02.md` (П-7, П-8, П-9)
**Scope**: Э4 (Б3): Warning-блок в cleanup; Э1 (Б5): информационное примечание о статистике; общее: подтверждение П-9
---

## Назначение

Этот документ — **дельта-патч** к промту v1.11 (через цепочку v1.1 → v1.11). Он реализует три решения, принятых на встрече 18.02.2026:

**П-7 [Should]** — Ответственность за реализацию таймеров автоматической уборки (cron-задачи по событиям «доставка блюда» и «закрытие чека») **не определена**. NE рассматривает реализацию на своей стороне. Добавляется Warning-блок на вкладку cleanup (Э4).

> **Олег (NE)** (18.02): *«Это позже обсудим. Мы сейчас пока думаем, на самом деле, как это сделать. Можем, в принципе, на своей стороне организовать. Это всё скорее вопрос дополнительных денег.»*

**П-8 [Could]** — Статистика выполненных задач робота (счётчики по типам) на экране Б5 **отложена за пределы MVP**. Никаких UI-изменений — только информационная фиксация.

> **Руслан** (18.02): *«Может быть, конечно, статистики часть сюда закинуть, например, сколько задач он сегодня выполнил... Я думаю, это мы уже потом тогда сделаем. Сейчас нет смысла усложнять.»*
> **Кирилл** (18.02): *«В рамках MVP я бы со своей стороны не рекомендовал сейчас это делать.»*

**П-9 [Must]** — Принудительный маркетинг через плагин iikoFront (ручная кнопка) **не нужен**. Если `after_action = marketing`, робот автоматически запускает маркетинговый круиз. Никаких UI-изменений в Admin Panel — решение подтверждает удаление вкладки «Маркетинг» (П-5, v1.11).

> **Руслан** (18.02): *«Да нет, наверное, она [кнопка маркетинга] даже не нужна, если мы там выставили настройку. И он автоматически поехал в маркетинг.»*

**Инструкция по применению**: сначала примени базовый промт v1.1, затем патчи v1.2 → ... → v1.11 → затем этот патч v1.12 — последовательно.

**Ключевые изменения v1.12:**
- [П-7] Добавлен Warning-блок в секцию «Таймеры автоматической уборки» на cleanup-вкладке (Э4)
- [П-8] Информационная фиксация: статистика задач Б5 — за пределами MVP (без UI-изменений)
- [П-9] Информационное подтверждение: принудительный маркетинг не нужен (без UI-изменений, покрыто П-5 v1.11)

---

## Совместимость с предыдущими патчами

| Патч           | Совместимость | Примечание                                                                          |
| -------------- | ------------- | ----------------------------------------------------------------------------------- |
| v1.1 (базовый) | Требуется     | Базовые экраны Э0–Э4                                                                |
| v1.2 (C1–C10)  | Требуется     | C3: Radio Group cleanup (O1 добавляет блок в эту секцию)                            |
| v1.6 (H1–H6)   | Требуется     | H1–H6: Рефакторинг cleanup — секция «Таймеры» (O1 добавляет блок внутри)           |
| v1.11 (N1–N13) | Требуется     | N11–N12: удаление вкладки «Маркетинг» (П-9 подтверждает это решение)                |
| Остальные      | Совместим     | O1 не конфликтует с другими патчами                                                  |

---

## Блоки изменений

### O1. [П-7] Добавить Warning-блок о неопределённой ответственности за таймеры авто-уборки

**Файл**: `app/settings/page.tsx` (экран Э4 — Настройки сценариев, вкладка Cleanup)

**Контекст**: В секции «Таймеры автоматической уборки» (видна при `mode = auto` или `mode = mixed`) **после** полей `timer_after_dish_min` и `timer_after_check_min` — добавить Warning-блок.

### ДОБАВИТЬ

Внутри секции «Таймеры автоматической уборки», после двух полей (таймер после доставки блюда, таймер после закрытия чека), добавить:

```tsx
{/* O1: Warning — ответственность за cron не определена [П-7] */}
{(cleanupSettings.mode === "auto" || cleanupSettings.mode === "mixed") && (
  <div className="rounded-lg border border-orange-200 bg-orange-50/50 p-4">
    <div className="flex items-start gap-3">
      <AlertTriangle className="h-5 w-5 text-orange-500 mt-0.5 shrink-0" />
      <div className="space-y-1">
        <p className="text-sm font-medium text-orange-800">
          Ответственность не определена
        </p>
        <p className="text-xs text-orange-600">
          Решение о том, кто реализует таймеры автоматической уборки
          (cron-задачи по событиям «доставка блюда» и «закрытие чека»),
          пока не принято. NE рассматривает реализацию на своей стороне.
          Это может повлиять на архитектуру и стоимость разработки.
        </p>
      </div>
    </div>
  </div>
)}
```

**Импорт**: Убедиться, что `AlertTriangle` из `lucide-react` импортирован.

**Визуальное расположение**:

```
Секция «Таймеры автоматической уборки»
├── Поле: Таймер после доставки блюда (12 мин)
├── Поле: Таймер после закрытия чека
└── [Warning-блок: Ответственность не определена]  ← O1
```

---

### O2. [П-8] Информационная фиксация — статистика задач Б5 за пределами MVP

**Файл**: нет изменений в коде

**Описание**: Статистика выполненных задач робота (количество меню развёз, посуды убрал, блюд доставил) на экране Э1 (Б5) **не включается в MVP**. Это чисто документационное решение — никаких UI-элементов (столбцов, счётчиков, графиков) добавлять **не нужно**.

**Решение**: Руслан (18.02) предложил идею, но сам же отложил. Кирилл поддержал: *«В рамках MVP я бы не рекомендовал»*.

**Действие**: Нет изменений в прототипе. Зафиксировано в SPEC-002 v1.20, открытый вопрос #28 [DEFERRED].

---

### O3. [П-9] Информационное подтверждение — принудительный маркетинг через плагин не нужен

**Файл**: нет изменений в коде

**Описание**: Кнопка «Маркетинг» в плагине iikoFront (принудительный ручной запуск маркетингового круиза) **убирается полностью**. Если `after_action = marketing`, робот автоматически запускает маркетинг — ручная кнопка не нужна.

**Влияние на Admin Panel**: **Нет**. Вкладка «Маркетинг» (Б3) уже удалена патчем v1.11 (N11–N12). Управление маркетингом — только через inline Select `after_action` на Э1 (Б5), что уже реализовано.

**Влияние на Плагин iikoFront**: Касается прототипа **плагина**, а не Admin Panel. Кнопка «Маркетинг» в контексте `order` и контексте `main` подлежит удалению/скрытию — но это scope отдельного патча плагина.

**Действие**: Нет изменений в прототипе Admin Panel. Зафиксировано в SPEC-002 v1.20, раздел 7.6a [REMOVED].

---

## Обновление mock-данных

Нет изменений в mock-данных.

---

## Обновление TypeScript интерфейсов

Нет изменений в интерфейсах.

---

## Обновление Toast-уведомлений

Нет изменений в toast-уведомлениях.

---

## Итого изменений v1.12

| #   | Блок | Правка | Экран     | Тип изменения      | Файл                    |
| --- | ---- | ------ | --------- | ------------------- | ----------------------- |
| 1   | O1   | П-7    | Э4 (Б3)   | Добавление UI-блока | `app/settings/page.tsx` |
| 2   | O2   | П-8    | Э1 (Б5)   | Информационная      | —                       |
| 3   | O3   | П-9    | — (плагин) | Информационная      | —                       |

**UI-изменения**: 1 (Warning-блок на cleanup)
**Информационные фиксации**: 2 (статистика Б5, маркетинг плагин)

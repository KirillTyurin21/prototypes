# Промт-патч v1.6: Плагин iikoFront — управление роботами PUDU

---
**Версия**: 1.6
**Дата**: 2026-02-17
**Автор**: Кирилл Тюрин (системный аналитик)
**Статус**: [PENDING]
**Артефакт**: Д4-патч (Промт-патч для обновления прототипа iikoFront POS-плагина)
**Базовый документ**: Промт_прототипа_PUDU_плагин_iikoFront_v1.5_патч.md (v1.5, 2026-02-17)
**Источники**: стенограмма 06.02 (Олег, NE); стенограмма 11.02 (Кирилл); Промт_прототипа_PUDU_Admin_панели_v1.5_патч.md (G4–G7)
**Scope**: Удаление `phrase_fail` / `phrase_fail_url` из сценария cleanup — синхронизация с Admin Panel v1.5 (G4–G7)
---

## Назначение

Этот документ — **дельта-патч** к промту v1.5 плагина iikoFront. Он описывает **только изменения**, связанные с удалением полей `phrase_fail` / `phrase_fail_url` из mock-настроек сценария `cleanup` — аналогично патчу Admin Panel v1.5 (G4–G7).

**Причина**: Робот PUDU не имеет доступных через API датчиков для определения нагрузки на полки. Фраза «Я приеду позже за посудой» предполагала триггер «гость НЕ положил посуду», который технически невозможен. Поведение по тайм-ауту: робот стоит `wait_time` секунд и уезжает безусловно.

> **Источник**: Встреча 06.02 — Олег (NE): *«У нас нет доступа к его инфракрасным датчикам. Прямо сейчас это всё решается тайм-аутом.»*  
> **Подтверждение**: Встреча 11.02 — Кирилл: *«Здесь рудимент остался. Этой фразы не будет.»*

**Инструкция по применению**: сначала примени базовый промт `Промт_прототипа_PUDU_плагин_iikoFront.md` (v1.0), затем патчи v1.1, v1.2, v1.3, v1.4, v1.5 и затем этот патч v1.6 — последовательно.

**Ключевые изменения v1.6:**
- Удалены `phrase_fail` и `phrase_fail_url` из `mockScenarioSettings.cleanup`
- Синхронизация с Admin Panel v1.5 патч (G4–G7)

---

## Совместимость с предыдущими патчами

| Патч           | Совместимость | Примечание                                             |
| -------------- | ------------- | ------------------------------------------------------ |
| v1.0 (базовый) | Требуется     | Исходные mock-данные с `phrase_later`                  |
| v1.1 (D1–D8)   | Требуется     | Добавлен `phrase_later_url`                            |
| v1.2 (E1–E11)  | Требуется     | Каталог ячеек                                          |
| v1.3 (F1–F9)   | Требуется     | Переименование `phrase_later` → `phrase_fail` (F6)     |
| v1.4 (H1–H14)  | Требуется     | `cleanup.mode: "mixed"`, повторение `phrase_fail` (H6) |
| v1.5 (I1–I11)  | Требуется     | Двойное имя робота                                     |

---

## Перечень изменений v1.6

| #      | Изменение                                      | Область     | Причина                                        |
| ------ | ---------------------------------------------- | ----------- | ---------------------------------------------- |
| **J1** | УДАЛИТЬ `phrase_fail` из mock cleanup settings | Mock-данные | Нет доступа к ИК-датчикам → триггер невозможен |
| **J2** | УДАЛИТЬ `phrase_fail_url` из mock cleanup      | Mock-данные | Синхронизация с удалённым полем                |
| **J3** | ОБНОВИТЬ комментарий cleanup в mock-данных     | Mock-данные | Пояснение поведения по тайм-ауту               |

---

## J1–J3. УДАЛИТЬ `phrase_fail` и `phrase_fail_url` из mock-данных cleanup

### ИЗМЕНИТЬ: `mockScenarioSettings.cleanup` (определён в v1.3 F6, обновлён в v1.4 H6)

**Было (v1.4 H6):**
```typescript
  // --- Уборка посуды — ручная (S2) ---
  cleanup: {
    mode: "mixed",                               // v1.4 (H6): изменено с "manual" на "mixed" для демо
    phrase: "Пожалуйста, поставьте грязную посуду на поднос",
    phrase_url: "",
    wait_time: 90,
    phrase_fail: "Я приеду позже за посудой",
    phrase_fail_url: ""
  },
```

**Стало (v1.6):**
```typescript
  // --- Уборка посуды — ручная (S2) ---
  cleanup: {
    mode: "mixed",                               // v1.4 (H6): "mixed" для демо
    phrase: "Пожалуйста, поставьте грязную посуду на поднос",
    phrase_url: "",
    wait_time: 90                                // Робот стоит N сек и уезжает безусловно
    // phrase_fail — УДАЛЕНО (v1.6 J1): нет доступа к ИК-датчикам робота,
    // робот не может определить, положил ли гость посуду.
    // Решается тайм-аутом (wait_time): робот стоит и уезжает.
  },
```

---

### Проверка: затронутые файлы промтов (хронология `phrase_fail` в cleanup)

| Патч        | Поле в промте                     | Действие (v1.6)   |
| ----------- | --------------------------------- | ----------------- |
| v1.0 base   | `phrase_later` (cleanup mock)     | Перезаписано v1.3 |
| v1.1 D      | `phrase_later_url` (cleanup mock) | Перезаписано v1.3 |
| **v1.3 F6** | `phrase_fail` (cleanup mock)      | **УДАЛЕНО J1**    |
| **v1.3 F6** | `phrase_fail_url` (cleanup mock)  | **УДАЛЕНО J2**    |
| **v1.4 H6** | `phrase_fail` (повторение)        | **УДАЛЕНО J1**    |
| **v1.4 H6** | `phrase_fail_url` (повторение)    | **УДАЛЕНО J2**    |

> **Примечание**: v1.4 H6 полностью перезаписывал `mockScenarioSettings.cleanup` — поэтому данный патч J1–J3 перезаписывает именно версию из H6.

---

### Проверка: `phrase_fail` в QR-оплате — НЕ ЗАТРОНУТО

Поле `phrase_fail` в `mockScenarioSettings.qr_payment` **остаётся без изменений**, т.к. имеет **другой смысл**: фраза при неуспешной оплате (триггер — возврат ошибки от платёжной системы, а не от датчиков робота).

```typescript
  // --- Оплата QR (S3) --- НЕ ИЗМЕНЯЕТСЯ ---
  qr_payment: {
    // ...
    phrase_fail: "К сожалению, оплата не прошла. Обратитесь к официанту",  // ← ОСТАЁТСЯ
    phrase_fail_url: ""                                                    // ← ОСТАЁТСЯ
  },
```

---

## Обновление итогового чеклиста

В дополнение к чеклисту v1.5, добавить:

- [ ] J1: Поле `phrase_fail` удалено из `mockScenarioSettings.cleanup`
- [ ] J2: Поле `phrase_fail_url` удалено из `mockScenarioSettings.cleanup`
- [ ] J3: Добавлен комментарий о поведении по тайм-ауту
- [ ] Поле `phrase_fail` в `qr_payment` **не затронуто** (другой смысл)
- [ ] Синхронизация с Admin Panel v1.5 (G4–G7) — оба прототипа консистентны

---

## История изменений

| Версия | Дата       | Автор        | Описание                                                                                                                                                                                                                                                                                         |
| ------ | ---------- | ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1.6    | 2026-02-17 | Кирилл Тюрин | Удаление `phrase_fail` / `phrase_fail_url` из cleanup mock-данных — робот не имеет доступа к ИК-датчикам (подтверждено NE 06.02), триггер фразы «Я приеду позже» технически невозможен. Синхронизация с Admin Panel v1.5 (G4–G7). Поле `phrase_fail` в qr_payment не затронуто (другой триггер). |
